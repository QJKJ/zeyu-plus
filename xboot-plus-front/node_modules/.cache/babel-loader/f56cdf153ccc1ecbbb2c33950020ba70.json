{"remainingRequest":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\babel-loader\\lib\\index.js!D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\zeyu\\zeyu-plus\\xboot-plus-front\\src\\views\\login.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\src\\views\\login.vue","mtime":1545992376866},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1545803981415},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\babel-loader\\lib\\index.js","mtime":1529635966000},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Cookies from \"js-cookie\";\nimport { login, userInfo, githubLogin, qqLogin, weiboLogin, getJWT, sendSms, smsLogin } from \"@/api/index\";\nimport util from \"@/libs/util.js\";\nexport default {\n  data: function data() {\n    var validateMobile = function validateMobile(rule, value, callback) {\n      var reg = /^[1][3,4,5,6,7,8][0-9]{9}$/;\n\n      if (!reg.test(value)) {\n        callback(new Error(\"手机号格式错误\"));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      socialLogining: true,\n      error: false,\n      errorMsg: \"\",\n      tabName: \"username\",\n      saveLogin: true,\n      loading: false,\n      sending: false,\n      sended: false,\n      count: 60,\n      countButton: \"60 s\",\n      maxLength: 6,\n      errorCode: \"\",\n      form: {\n        username: \"test或test2 可注册 支持Github、QQ、微博登录\",\n        password: \"123456\",\n        mobile: \"阿里云短信0.045/条 如需测试捐赠联系作者充值\",\n        code: \"\"\n      },\n      rules: {\n        username: [{\n          required: true,\n          message: \"账号不能为空\",\n          trigger: \"blur\"\n        }],\n        password: [{\n          required: true,\n          message: \"密码不能为空\",\n          trigger: \"blur\"\n        }],\n        mobile: [{\n          required: true,\n          message: \"手机号不能为空\",\n          trigger: \"blur\"\n        }, {\n          validator: validateMobile,\n          trigger: \"blur\"\n        }]\n      }\n    };\n  },\n  methods: {\n    showErrorMsg: function showErrorMsg(msg) {\n      this.error = true;\n      this.errorMsg = msg;\n    },\n    sendVerify: function sendVerify() {\n      var _this = this;\n\n      this.$refs.mobileLoginForm.validate(function (valid) {\n        if (valid) {\n          _this.sending = true;\n          sendSms(_this.form.mobile, {\n            type: 1\n          }).then(function (res) {\n            _this.sending = false;\n\n            if (res.success) {\n              _this.$Message.success(\"发送短信验证码成功\");\n\n              _this.sended = true;\n\n              _this.countDown();\n            }\n          });\n        }\n      });\n    },\n    countDown: function countDown() {\n      var that = this;\n\n      if (this.count === 0) {\n        this.sended = false;\n        this.count = 60;\n        return;\n      } else {\n        this.countButton = this.count + \" s\";\n        this.count--;\n      }\n\n      setTimeout(function () {\n        that.countDown();\n      }, 1000);\n    },\n    submitLogin: function submitLogin() {\n      var _this2 = this;\n\n      if (this.tabName === \"username\") {\n        this.$refs.usernameLoginForm.validate(function (valid) {\n          if (valid) {\n            _this2.loading = true;\n            login({\n              username: _this2.form.username,\n              password: _this2.form.password,\n              saveLogin: _this2.saveLogin\n            }).then(function (res) {\n              if (res.success === true) {\n                _this2.setStore(\"accessToken\", res.result); // 获取用户信息\n\n\n                userInfo().then(function (res) {\n                  if (res.success === true) {\n                    // 避免超过大小限制\n                    delete res.result.permissions;\n                    var roles = [];\n                    res.result.roles.forEach(function (e) {\n                      roles.push(e.name);\n                    });\n\n                    _this2.setStore(\"roles\", roles);\n\n                    _this2.setStore(\"saveLogin\", _this2.saveLogin);\n\n                    if (_this2.saveLogin) {\n                      // 保存7天\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result), {\n                        expires: 7\n                      });\n                    } else {\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result));\n                    }\n\n                    _this2.setStore(\"userInfo\", res.result);\n\n                    _this2.$store.commit(\"setAvatarPath\", res.result.avatar); // 加载菜单\n\n\n                    util.initRouter(_this2);\n\n                    _this2.$router.push({\n                      name: \"home_index\"\n                    });\n                  } else {\n                    _this2.loading = false;\n                  }\n                });\n              } else {\n                _this2.loading = false;\n              }\n            });\n          }\n        });\n      } else if (this.tabName === \"mobile\") {\n        this.$refs.mobileLoginForm.validate(function (valid) {\n          if (valid) {\n            if (_this2.form.code === \"\") {\n              _this2.errorCode = \"验证码不能为空\";\n              return;\n            } else {\n              _this2.errorCode = \"\";\n            }\n\n            _this2.loading = true;\n            _this2.form.saveLogin = _this2.saveLogin;\n            smsLogin(_this2.form).then(function (res) {\n              if (res.success) {\n                _this2.setStore(\"accessToken\", res.result); // 获取用户信息\n\n\n                userInfo().then(function (res) {\n                  if (res.success === true) {\n                    // 避免超过大小限制\n                    delete res.result.permissions;\n                    var roles = [];\n                    res.result.roles.forEach(function (e) {\n                      roles.push(e.name);\n                    });\n\n                    _this2.setStore(\"roles\", roles);\n\n                    if (_this2.saveLogin) {\n                      // 保存7天\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result), {\n                        expires: 7\n                      });\n                    } else {\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result));\n                    }\n\n                    _this2.setStore(\"userInfo\", res.result);\n\n                    _this2.$store.commit(\"setAvatarPath\", res.result.avatar); // 加载菜单\n\n\n                    util.initRouter(_this2);\n\n                    _this2.$router.push({\n                      name: \"home_index\"\n                    });\n                  } else {\n                    _this2.loading = false;\n                  }\n                });\n              } else {\n                _this2.loading = false;\n              }\n            });\n          }\n        });\n      }\n    },\n    toGithubLogin: function toGithubLogin() {\n      var _this3 = this;\n\n      this.socialLogining = true;\n      githubLogin().then(function (res) {\n        if (res.success) {\n          window.location.href = res.result;\n        } else {\n          _this3.socialLogining = false;\n        }\n      });\n    },\n    toQQLogin: function toQQLogin() {\n      var _this4 = this;\n\n      this.socialLogining = true;\n      qqLogin().then(function (res) {\n        if (res.success) {\n          window.location.href = res.result;\n        } else {\n          _this4.socialLogining = false;\n        }\n      });\n    },\n    toWeiboLogin: function toWeiboLogin() {\n      var _this5 = this;\n\n      this.socialLogining = true;\n      weiboLogin().then(function (res) {\n        if (res.success) {\n          window.location.href = res.result;\n        } else {\n          _this5.socialLogining = false;\n        }\n      });\n    },\n    toWeixinLogin: function toWeixinLogin() {\n      this.$Message.error(\"开通微信登录官方收费300/年\");\n    },\n    relatedLogin: function relatedLogin() {\n      var _this6 = this;\n\n      var q = this.$route.query;\n      var error = q.error;\n\n      if (error !== \"\" && error !== undefined) {\n        this.$Message.error(error);\n      }\n\n      var related = q.related;\n      var JWTKey = q.JWTKey;\n\n      if (related && related === \"1\") {\n        if (JWTKey !== \"\" && JWTKey !== undefined) {\n          getJWT({\n            JWTKey: JWTKey\n          }).then(function (res) {\n            if (res.success) {\n              _this6.socialLogining = true;\n\n              _this6.setStore(\"accessToken\", res.result); // 获取用户信息\n\n\n              userInfo().then(function (res) {\n                if (res.success === true) {\n                  // 避免超过大小限制\n                  delete res.result.permissions;\n                  var roles = [];\n                  res.result.roles.forEach(function (e) {\n                    roles.push(e.name);\n                  });\n\n                  _this6.setStore(\"roles\", roles); // 保存7天\n\n\n                  Cookies.set(\"userInfo\", JSON.stringify(res.result), {\n                    expires: 7\n                  });\n\n                  _this6.setStore(\"userInfo\", res.result);\n\n                  _this6.$store.commit(\"setAvatarPath\", res.result.avatar); // 加载菜单\n\n\n                  util.initRouter(_this6);\n\n                  _this6.$router.push({\n                    name: \"home_index\"\n                  });\n                } else {\n                  _this6.socialLogining = false;\n\n                  _this6.$Message.error(\"使用第三方账号登录失败\");\n                }\n              });\n            } else {\n              _this6.socialLogining = false;\n\n              _this6.$Message.error(\"使用第三方账号登录失败\");\n            }\n          });\n        }\n      } else {\n        this.socialLogining = false;\n      }\n    },\n    handleDropDown: function handleDropDown(v) {\n      if (v == \"showAccount\") {\n        this.showAccount();\n      } else if (v == \"resetByMobile\") {\n        this.$router.push({\n          name: \"reset\"\n        });\n      } else if (v == \"resetByEmail\") {\n        this.$router.push({\n          name: \"reset\",\n          query: {\n            type: \"1\"\n          }\n        });\n      }\n    },\n    showAccount: function showAccount() {\n      this.$Notice.info({\n        title: \"体验账号密码\",\n        desc: \"账号1：test 密码：123456 <br>账号2：test2 密码：123456 已开放注册！\",\n        duration: 10\n      });\n    },\n    showMessage: function showMessage() {\n      this.$Notice.success({\n        title: \"已升级至iView3.0\",\n        desc: \"完善多项功能，包括数据权限、部门管理、定时任务、数据字典、前端模版等 修复已知BUG\",\n        duration: 5\n      });\n    }\n  },\n  mounted: function mounted() {\n    this.showMessage();\n    this.showAccount();\n    this.relatedLogin();\n  }\n};",{"version":3,"sources":["login.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <Row type=\"flex\" justify=\"center\" align=\"middle\" class=\"login\" @keydown.enter.native=\"submitLogin\">\r\n    <Col :xs=\"{span:22}\" style=\"width: 368px;\">\r\n    <Row class=\"header\">\r\n      <img src=\"../assets/xboot.png\" width=\"220px\" />\r\n      <div class=\"description\">X-Boot 是很不错的Web前后端分离架构开发平台</div>\r\n    </Row>\r\n  \r\n    <Alert type=\"error\" show-icon v-if=\"error\">{{errorMsg}}</Alert>\r\n  \r\n    <Row class=\"login-form\" v-if=\"!socialLogining\">\r\n      <Tabs v-model=\"tabName\">\r\n        <TabPane label=\"账户密码登录\" name=\"username\" icon=\"md-person\">\r\n          <Form ref=\"usernameLoginForm\" :model=\"form\" :rules=\"rules\" class=\"form\" v-if=\"tabName=='username'\">\r\n            <FormItem prop=\"username\">\r\n              <Input v-model=\"form.username\" prefix=\"ios-contact\" size=\"large\" clearable placeholder=\"请输入用户名\" autocomplete=\"off\" />\r\n            </FormItem>\r\n            <FormItem prop=\"password\">\r\n              <Input type=\"password\" v-model=\"form.password\" prefix=\"ios-lock\" size=\"large\" clearable placeholder=\"请输入密码\" autocomplete=\"off\" />\r\n            </FormItem>\r\n          </Form>\r\n        </TabPane>\r\n        <TabPane label=\"手机号登录\" name=\"mobile\" icon=\"ios-phone-portrait\">\r\n          <Form ref=\"mobileLoginForm\" :model=\"form\" :rules=\"rules\" class=\"form\" v-if=\"tabName=='mobile'\">\r\n            <FormItem prop=\"mobile\">\r\n              <Input v-model=\"form.mobile\" prefix=\"ios-phone-portrait\" size=\"large\" clearable placeholder=\"请输入手机号\" />\r\n            </FormItem>\r\n            <FormItem prop=\"code\" :error=\"errorCode\">\r\n              <Row type=\"flex\" justify=\"space-between\">\r\n                <Input v-model=\"form.code\" prefix=\"ios-mail-outline\" size=\"large\" clearable placeholder=\"请输入短信验证码\" :maxlength=\"maxLength\" class=\"input-verify\" />\r\n                <Button size=\"large\" :loading=\"sending\" @click=\"sendVerify\" v-if=\"!sended\" class=\"send-verify\">\r\n                  <span v-if=\"!sending\">获取验证码</span>\r\n                  <span v-else>发送中</span>\r\n                </Button>\r\n                <Button size=\"large\" disabled v-if=\"sended\" class=\"count-verify\">{{countButton}}</Button>\r\n              </Row>\r\n            </FormItem>\r\n          </Form>\r\n        </TabPane>\r\n      </Tabs>\r\n  \r\n      <Row type=\"flex\" justify=\"space-between\">\r\n        <Checkbox v-model=\"saveLogin\" size=\"large\">自动登录</Checkbox>\r\n        <Dropdown trigger=\"click\" @on-click=\"handleDropDown\">\r\n          <a class=\"forget-pass\">\r\n            忘记密码\r\n          </a>\r\n          <DropdownMenu slot=\"list\">\r\n            <DropdownItem name=\"showAccount\">体验测试账号</DropdownItem>\r\n            <DropdownItem name=\"resetByMobile\">使用手机号重置密码(付费)</DropdownItem>\r\n            <DropdownItem name=\"resetByEmail\">使用邮箱重置密码(付费)</DropdownItem>\r\n          </DropdownMenu>\r\n        </Dropdown>\r\n      </Row>\r\n      <Row>\r\n        <Button class=\"login-btn\" type=\"primary\" size=\"large\" :loading=\"loading\" @click=\"submitLogin\" long>\r\n                            <span v-if=\"!loading\">登录</span>\r\n                            <span v-else>登录中...</span>\r\n                        </Button>\r\n      </Row>\r\n      <Row type=\"flex\" justify=\"space-between\" class=\"other-login\">\r\n        <div class=\"other-way icons\">\r\n          其它方式登录\r\n          <div class=\"other-icon\" @click=\"toGithubLogin\">\r\n            <icon scale=\"1.1\" name=\"brands/github\"></icon>\r\n          </div>\r\n          <div class=\"other-icon\" @click=\"toQQLogin\">\r\n            <icon name=\"brands/qq\"></icon>\r\n          </div>\r\n          <div class=\"other-icon\" @click=\"toWeiboLogin\">\r\n            <icon scale=\"1.2\" name=\"brands/weibo\"></icon>\r\n          </div>\r\n          <div class=\"other-icon\" @click=\"toWeixinLogin\">\r\n            <icon scale=\"1.2\" name=\"brands/weixin\"></icon>\r\n          </div>\r\n        </div>\r\n        <router-link to=\"/regist\"><a class=\"forget-pass\">注册账户</a></router-link>\r\n      </Row>\r\n    </Row>\r\n    <div v-if=\"socialLogining\" class=\"spinner\">\r\n      <div class=\"rect1\"></div>\r\n      <div class=\"rect2\"></div>\r\n      <div class=\"rect3\"></div>\r\n      <div class=\"rect4\"></div>\r\n      <div class=\"rect5\"></div>\r\n      <!-- <span>用户数据加载中...</span> -->\r\n    </div>\r\n  \r\n    <Row class=\"foot\">\r\n      <Row type=\"flex\" justify=\"space-around\" class=\"help\">\r\n        <a class=\"item\" href=\"https://github.com/Exrick/x-boot\" target=\"_blank\">帮助</a>\r\n        <a class=\"item\" href=\"https://github.com/Exrick/x-boot\" target=\"_blank\">隐私</a>\r\n        <a class=\"item\" href=\"https://github.com/Exrick/x-boot\" target=\"_blank\">条款</a>\r\n      </Row>\r\n      <Row type=\"flex\" justify=\"center\" class=\"copyright\">\r\n        Copyright © 2018 - Present <a href=\"http://exrick.cn\" target=\"_blank\" style=\"margin:0 5px;\">Exrick</a> 版权所有\r\n      </Row>\r\n    </Row>\r\n    </Col>\r\n  </Row>\r\n</template>\r\n\r\n<script>\r\nimport Cookies from \"js-cookie\";\r\nimport {\r\n  login,\r\n  userInfo,\r\n  githubLogin,\r\n  qqLogin,\r\n  weiboLogin,\r\n  getJWT,\r\n  sendSms,\r\n  smsLogin\r\n} from \"@/api/index\";\r\nimport util from \"@/libs/util.js\";\r\nexport default {\r\n  data() {\r\n    const validateMobile = (rule, value, callback) => {\r\n      var reg = /^[1][3,4,5,6,7,8][0-9]{9}$/;\r\n      if (!reg.test(value)) {\r\n        callback(new Error(\"手机号格式错误\"));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n    return {\r\n      socialLogining: true,\r\n      error: false,\r\n      errorMsg: \"\",\r\n      tabName: \"username\",\r\n      saveLogin: true,\r\n      loading: false,\r\n      sending: false,\r\n      sended: false,\r\n      count: 60,\r\n      countButton: \"60 s\",\r\n      maxLength: 6,\r\n      errorCode: \"\",\r\n      form: {\r\n        username: \"test或test2 可注册 支持Github、QQ、微博登录\",\r\n        password: \"123456\",\r\n        mobile: \"阿里云短信0.045/条 如需测试捐赠联系作者充值\",\r\n        code: \"\"\r\n      },\r\n      rules: {\r\n        username: [\r\n          {\r\n            required: true,\r\n            message: \"账号不能为空\",\r\n            trigger: \"blur\"\r\n          }\r\n        ],\r\n        password: [\r\n          {\r\n            required: true,\r\n            message: \"密码不能为空\",\r\n            trigger: \"blur\"\r\n          }\r\n        ],\r\n        mobile: [\r\n          {\r\n            required: true,\r\n            message: \"手机号不能为空\",\r\n            trigger: \"blur\"\r\n          },\r\n          {\r\n            validator: validateMobile,\r\n            trigger: \"blur\"\r\n          }\r\n        ]\r\n      }\r\n    };\r\n  },\r\n  methods: {\r\n    showErrorMsg(msg) {\r\n      this.error = true;\r\n      this.errorMsg = msg;\r\n    },\r\n    sendVerify() {\r\n      this.$refs.mobileLoginForm.validate(valid => {\r\n        if (valid) {\r\n          this.sending = true;\r\n          sendSms(this.form.mobile, {type: 1}).then(res => {\r\n            this.sending = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"发送短信验证码成功\");\r\n              this.sended = true;\r\n              this.countDown();\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    countDown() {\r\n      let that = this;\r\n      if (this.count === 0) {\r\n        this.sended = false;\r\n        this.count = 60;\r\n        return;\r\n      } else {\r\n        this.countButton = this.count + \" s\";\r\n        this.count--;\r\n      }\r\n      setTimeout(function() {\r\n        that.countDown();\r\n      }, 1000);\r\n    },\r\n    submitLogin() {\r\n      if (this.tabName === \"username\") {\r\n        this.$refs.usernameLoginForm.validate(valid => {\r\n          if (valid) {\r\n            this.loading = true;\r\n            login({\r\n              username: this.form.username,\r\n              password: this.form.password,\r\n              saveLogin: this.saveLogin\r\n            }).then(res => {\r\n              if (res.success === true) {\r\n                this.setStore(\"accessToken\", res.result);\r\n                // 获取用户信息\r\n                userInfo().then(res => {\r\n                  if (res.success === true) {\r\n                    // 避免超过大小限制\r\n                    delete res.result.permissions;\r\n                    let roles = [];\r\n                    res.result.roles.forEach(e => {\r\n                      roles.push(e.name);\r\n                    });\r\n                    this.setStore(\"roles\", roles);\r\n                    this.setStore(\"saveLogin\", this.saveLogin);\r\n                    if (this.saveLogin) {\r\n                      // 保存7天\r\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result), {\r\n                        expires: 7\r\n                      });\r\n                    } else {\r\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result));\r\n                    }\r\n                    this.setStore(\"userInfo\", res.result);\r\n                    this.$store.commit(\"setAvatarPath\", res.result.avatar);\r\n                    // 加载菜单\r\n                    util.initRouter(this);\r\n                    this.$router.push({\r\n                      name: \"home_index\"\r\n                    });\r\n                  } else {\r\n                    this.loading = false;\r\n                  }\r\n                });\r\n              } else {\r\n                this.loading = false;\r\n              }\r\n            });\r\n          }\r\n        });\r\n      } else if (this.tabName === \"mobile\") {\r\n        this.$refs.mobileLoginForm.validate(valid => {\r\n          if (valid) {\r\n            if (this.form.code === \"\") {\r\n              this.errorCode = \"验证码不能为空\";\r\n              return;\r\n            } else {\r\n              this.errorCode = \"\";\r\n            }\r\n            this.loading = true;\r\n            this.form.saveLogin = this.saveLogin;\r\n            smsLogin(this.form).then(res => {\r\n              if (res.success) {\r\n                this.setStore(\"accessToken\", res.result);\r\n                // 获取用户信息\r\n                userInfo().then(res => {\r\n                  if (res.success === true) {\r\n                    // 避免超过大小限制\r\n                    delete res.result.permissions;\r\n                    let roles = [];\r\n                    res.result.roles.forEach(e => {\r\n                      roles.push(e.name);\r\n                    });\r\n                    this.setStore(\"roles\", roles);\r\n                    if (this.saveLogin) {\r\n                      // 保存7天\r\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result), {\r\n                        expires: 7\r\n                      });\r\n                    } else {\r\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result));\r\n                    }\r\n                    this.setStore(\"userInfo\", res.result);\r\n                    this.$store.commit(\"setAvatarPath\", res.result.avatar);\r\n                    // 加载菜单\r\n                    util.initRouter(this);\r\n                    this.$router.push({\r\n                      name: \"home_index\"\r\n                    });\r\n                  } else {\r\n                    this.loading = false;\r\n                  }\r\n                });\r\n              } else {\r\n                this.loading = false;\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }\r\n    },\r\n    toGithubLogin() {\r\n      this.socialLogining = true;\r\n      githubLogin().then(res => {\r\n        if (res.success) {\r\n          window.location.href = res.result;\r\n        } else {\r\n          this.socialLogining = false;\r\n        }\r\n      });\r\n    },\r\n    toQQLogin() {\r\n      this.socialLogining = true;\r\n      qqLogin().then(res => {\r\n        if (res.success) {\r\n          window.location.href = res.result;\r\n        } else {\r\n          this.socialLogining = false;\r\n        }\r\n      });\r\n    },\r\n    toWeiboLogin() {\r\n      this.socialLogining = true;\r\n      weiboLogin().then(res => {\r\n        if (res.success) {\r\n          window.location.href = res.result;\r\n        } else {\r\n          this.socialLogining = false;\r\n        }\r\n      });\r\n    },\r\n    toWeixinLogin() {\r\n      this.$Message.error(\"开通微信登录官方收费300/年\");\r\n    },\r\n    relatedLogin() {\r\n      let q = this.$route.query;\r\n      let error = q.error;\r\n      if (error !== \"\" && error !== undefined) {\r\n        this.$Message.error(error);\r\n      }\r\n      let related = q.related;\r\n      let JWTKey = q.JWTKey;\r\n      if (related && related === \"1\") {\r\n        if (JWTKey !== \"\" && JWTKey !== undefined) {\r\n          getJWT({ JWTKey: JWTKey }).then(res => {\r\n            if (res.success) {\r\n              this.socialLogining = true;\r\n              this.setStore(\"accessToken\", res.result);\r\n              // 获取用户信息\r\n              userInfo().then(res => {\r\n                if (res.success === true) {\r\n                  // 避免超过大小限制\r\n                  delete res.result.permissions;\r\n                  let roles = [];\r\n                  res.result.roles.forEach(e => {\r\n                    roles.push(e.name);\r\n                  });\r\n                  this.setStore(\"roles\", roles);\r\n                  // 保存7天\r\n                  Cookies.set(\"userInfo\", JSON.stringify(res.result), {\r\n                    expires: 7\r\n                  });\r\n                  this.setStore(\"userInfo\", res.result);\r\n                  this.$store.commit(\"setAvatarPath\", res.result.avatar);\r\n                  // 加载菜单\r\n                  util.initRouter(this);\r\n                  this.$router.push({\r\n                    name: \"home_index\"\r\n                  });\r\n                } else {\r\n                  this.socialLogining = false;\r\n                  this.$Message.error(\"使用第三方账号登录失败\");\r\n                }\r\n              });\r\n            } else {\r\n              this.socialLogining = false;\r\n              this.$Message.error(\"使用第三方账号登录失败\");\r\n            }\r\n          });\r\n        }\r\n      } else {\r\n        this.socialLogining = false;\r\n      }\r\n    },\r\n    handleDropDown(v) {\r\n      if (v == \"showAccount\") {\r\n        this.showAccount();\r\n      } else if (v == \"resetByMobile\") {\r\n        this.$router.push({\r\n          name: \"reset\"\r\n        });\r\n      } else if (v == \"resetByEmail\") {\r\n        this.$router.push({\r\n          name: \"reset\",\r\n          query: {\r\n            type: \"1\"\r\n          }\r\n        });\r\n      }\r\n    },\r\n    showAccount() {\r\n      this.$Notice.info({\r\n        title: \"体验账号密码\",\r\n        desc:\r\n          \"账号1：test 密码：123456 <br>账号2：test2 密码：123456 已开放注册！\",\r\n        duration: 10\r\n      });\r\n    },\r\n    showMessage() {\r\n      this.$Notice.success({\r\n        title: \"已升级至iView3.0\",\r\n        desc: \"完善多项功能，包括数据权限、部门管理、定时任务、数据字典、前端模版等 修复已知BUG\",\r\n        duration: 5\r\n      });\r\n    }\r\n  },\r\n  mounted() {\r\n    this.showMessage();\r\n    this.showAccount();\r\n    this.relatedLogin();\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n@import \"./login.less\";\r\n</style>\r\n"],"sourceRoot":"src\\views"}]}
{"remainingRequest":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\babel-loader\\lib\\index.js!D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\zeyu\\zeyu-plus\\xboot-plus-front\\src\\views\\reset.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\src\\views\\reset.vue","mtime":1546053958875},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1545803981415},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\babel-loader\\lib\\index.js","mtime":1529635966000},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { vaptchaID, sendResetSms, resetByMobile, sendResetEmail, resetByEmail } from \"@/api/index\";\nimport common from \"@/libs/common\";\nimport Cookies from \"js-cookie\";\nvar vaptchaObject;\nexport default {\n  data: function data() {\n    var _this = this;\n\n    var validatePassword = function validatePassword(rule, value, callback) {\n      if (value.length < 6) {\n        callback(new Error(\"密码长度不得小于6位\"));\n      } else {\n        callback();\n      }\n    };\n\n    var validateConfirmPass = function validateConfirmPass(rule, value, callback) {\n      if (value.length < 6) {\n        callback(new Error(\"密码长度不得小于6位\"));\n      } else if (value !== _this.form.password) {\n        callback(new Error(\"两次输入的密码不一致\"));\n      } else {\n        callback();\n      }\n    };\n\n    var validateMobile = function validateMobile(rule, value, callback) {\n      var reg = /^[1][3,4,5,6,7,8][0-9]{9}$/;\n\n      if (!reg.test(value)) {\n        callback(new Error(\"手机号格式错误\"));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      label: \"使用手机号重置密码\",\n      icon: \"md-phone-portrait\",\n      loading: false,\n      type: \"0\",\n      form: {\n        mobile: \"\",\n        email: \"\",\n        token: \"\",\n        password: \"\",\n        passStrength: \"\"\n      },\n      sended: false,\n      sending: false,\n      count: 60,\n      countButton: \"60 s\",\n      tipStyle: \"password-tip-none\",\n      strength: \"无\",\n      select: \"86\",\n      strengthValue: 0,\n      errorMobile: \"\",\n      errorEmail: \"\",\n      rules: {\n        mobile: [{\n          required: true,\n          message: \"手机号不能为空\",\n          trigger: \"blur\"\n        }, {\n          validator: validateMobile,\n          trigger: \"blur\"\n        }],\n        email: [{\n          required: true,\n          message: \"请输入邮箱地址\",\n          trigger: \"blur\"\n        }, {\n          type: \"email\",\n          message: \"邮箱格式不正确\",\n          trigger: \"blur\"\n        }],\n        password: [{\n          required: true,\n          message: \"密码不能为空\",\n          trigger: \"blur\"\n        }, {\n          validator: validatePassword,\n          trigger: \"blur\"\n        }],\n        code: [{\n          required: true,\n          message: \"验证码不能为空\",\n          trigger: \"blur\"\n        }],\n        confirmPass: [{\n          required: true,\n          message: \"确认密码不能为空\",\n          trigger: \"blur\"\n        }, {\n          validator: validateConfirmPass,\n          trigger: \"blur\"\n        }]\n      }\n    };\n  },\n  methods: {\n    initVaptcha: function initVaptcha() {\n      var that = this;\n      vaptcha({\n        //配置参数\n        vid: vaptchaID,\n        // 验证单元id\n        type: \"invisible\" // 展现类型 隐藏式\n\n      }).then(function (vaptchaObj) {\n        vaptchaObject = vaptchaObj;\n        vaptchaObj.listen(\"pass\", function () {\n          that.form.token = vaptchaObj.getToken(); // 发送验证码\n\n          if (that.type == \"0\") {\n            that.sendSmsVerifyCode();\n          } else if (that.type == \"1\") {\n            that.sendEmailVerifyCode();\n          }\n        });\n      });\n    },\n    checkStrengthValue: function checkStrengthValue(v) {\n      // 评级制判断密码强度 最高5\n      var grade = 0;\n\n      if (/\\d/.test(v)) {\n        grade++; //数字\n      }\n\n      if (/[a-z]/.test(v)) {\n        grade++; //小写\n      }\n\n      if (/[A-Z]/.test(v)) {\n        grade++; //大写\n      }\n\n      if (/\\W/.test(v)) {\n        grade++; //特殊字符\n      }\n\n      if (v.length >= 10) {\n        grade++;\n      }\n\n      return grade;\n    },\n    strengthChange: function strengthChange() {\n      if (!this.form.password) {\n        this.tipStyle = \"password-tip-none\";\n        this.strength = \"无\";\n        this.strengthValue = 0;\n        return;\n      }\n\n      var grade = this.checkStrengthValue(this.form.password);\n\n      if (grade <= 1) {\n        this.tipStyle = \"password-tip-weak\";\n        this.strength = \"弱\";\n        this.strengthValue = 33;\n      } else if (grade >= 2 && grade <= 4) {\n        this.tipStyle = \"password-tip-middle\";\n        this.strength = \"中\";\n        this.strengthValue = 66;\n      } else {\n        this.tipStyle = \"password-tip-strong\";\n        this.strength = \"强\";\n        this.strengthValue = 100;\n      }\n    },\n    showVaptcha: function showVaptcha() {\n      if (this.type == \"0\") {\n        var reg = /^[1][3,4,5,6,7,8][0-9]{9}$/;\n\n        if (!reg.test(this.form.mobile)) {\n          this.errorMobile = \"手机号格式错误\";\n          return;\n        } else {\n          this.errorMobile = \"\";\n        }\n      } else if (this.type == \"1\") {\n        var reg = /^[A-Za-z\\d]+([-_.][A-Za-z\\d]+)*@([A-Za-z\\d]+[-.])+[A-Za-z\\d]{2,4}$/;\n\n        if (!reg.test(this.form.email)) {\n          this.errorEmail = \"邮箱格式错误\";\n          return;\n        } else {\n          this.errorEmail = \"\";\n        }\n      }\n\n      vaptchaObject.validate(); // 若没验证验证码 开始验证\n    },\n    sendSmsVerifyCode: function sendSmsVerifyCode() {\n      var _this2 = this;\n\n      this.sending = true;\n      sendResetSms(this.form).then(function (res) {\n        _this2.sending = false;\n        vaptchaObject.reset();\n\n        if (res.success) {\n          _this2.$Message.success(\"发送短信验证码成功\");\n\n          _this2.sended = true;\n\n          _this2.countDown();\n        }\n      });\n    },\n    sendEmailVerifyCode: function sendEmailVerifyCode() {\n      var _this3 = this;\n\n      this.sending = true;\n      sendResetEmail(this.form).then(function (res) {\n        _this3.sending = false;\n        vaptchaObject.reset();\n\n        if (res.success) {\n          _this3.$Message.success(\"发送邮件验证码成功，请注意查收\");\n\n          _this3.sended = true;\n\n          _this3.countDown();\n        }\n      });\n    },\n    countDown: function countDown() {\n      var that = this;\n\n      if (this.count === 0) {\n        this.sended = false;\n        this.count = 60;\n        return;\n      } else {\n        this.countButton = this.count + \" s\";\n        this.count--;\n      }\n\n      setTimeout(function () {\n        that.countDown();\n      }, 1000);\n    },\n    submitReset: function submitReset() {\n      var _this4 = this;\n\n      this.$refs.resetForm.validate(function (valid) {\n        if (valid) {\n          _this4.form.passStrength = _this4.strength;\n          _this4.loading = true;\n\n          if (_this4.type == \"0\") {\n            resetByMobile(_this4.form).then(function (res) {\n              _this4.loading = false;\n\n              if (res.success) {\n                _this4.$Message.success(\"重置密码成功，请牢记您的新密码\");\n\n                _this4.$router.push({\n                  name: \"login\"\n                });\n              }\n            });\n          } else if (_this4.type == \"1\") {\n            resetByEmail(_this4.form).then(function (res) {\n              _this4.loading = false;\n\n              if (res.success) {\n                _this4.$Message.success(\"重置密码成功，请牢记您的新密码\");\n\n                _this4.$router.push({\n                  name: \"login\"\n                });\n              }\n            });\n          }\n        }\n      });\n    }\n  },\n  mounted: function mounted() {\n    var type = this.$route.query.type;\n\n    if (type == \"1\") {\n      this.type = type;\n      this.label = \"使用邮箱重置密码\";\n      this.icon = \"ios-mail-outline\";\n    }\n\n    this.initVaptcha();\n    common.initWindowShades();\n  }\n};",{"version":3,"sources":["reset.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <Row type=\"flex\" justify=\"center\" align=\"middle\" class=\"reset-wrap\" @keydown.enter.native=\"submitReset\">\r\n    <Col :xs=\"{span:22}\" style=\"width: 368px;z-index:1;\">\r\n    <Row class=\"header\">\r\n      <img src=\"../assets/xboot.png\" width=\"220px\" />\r\n      <div class=\"description\">X-Boot 是很不错的Web前后端分离架构开发平台</div>\r\n    </Row>\r\n  \r\n    <Row class=\"reset\">\r\n      <Tabs value=\"1\">\r\n        <TabPane :label=\"label\" name=\"1\" :icon=\"icon\">\r\n        </TabPane>\r\n      </Tabs>\r\n      <Form ref=\"resetForm\" :model=\"form\" :rules=\"rules\" class=\"form\">\r\n        <div v-if=\"type=='0'\">\r\n          <FormItem prop=\"mobile\" :error=\"errorMobile\">\r\n            <Input v-model=\"form.mobile\" size=\"large\" clearable placeholder=\"请输入注册或绑定手机号\"></Input>\r\n          </FormItem>\r\n          <FormItem prop=\"code\">\r\n            <Row type=\"flex\" justify=\"space-between\">\r\n              <Input v-model=\"form.code\" size=\"large\" clearable placeholder=\"请输入短信验证码\" :maxlength=\"10\" class=\"input-verify\" />\r\n              <Button size=\"large\" :loading=\"sending\" @click=\"showVaptcha\" v-if=\"!sended\" class=\"send-verify\">\r\n                        <span v-if=\"!sending\">获取验证码</span>\r\n                        <span v-else>发送中</span>\r\n                      </Button>\r\n              <Button size=\"large\" disabled v-if=\"sended\" class=\"count-verify\">{{countButton}}</Button>\r\n            </Row>\r\n          </FormItem>\r\n        </div>\r\n        <div v-else>\r\n          <FormItem prop=\"email\" :error=\"errorEmail\">\r\n            <Input v-model=\"form.email\" size=\"large\" clearable placeholder=\"请输入绑定邮箱\"></Input>\r\n          </FormItem>\r\n          <FormItem prop=\"code\">\r\n            <Row type=\"flex\" justify=\"space-between\">\r\n              <Input v-model=\"form.code\" size=\"large\" clearable placeholder=\"请输入您收到的邮件中的验证码\" :maxlength=\"10\" class=\"input-verify\" />\r\n              <Button size=\"large\" :loading=\"sending\" @click=\"showVaptcha\" v-if=\"!sended\" class=\"send-verify\">\r\n                        <span v-if=\"!sending\">发送验证码</span>\r\n                        <span v-else>发送中</span>\r\n                      </Button>\r\n              <Button size=\"large\" disabled v-if=\"sended\" class=\"count-verify\">{{countButton}}</Button>\r\n            </Row>\r\n          </FormItem>\r\n        </div>\r\n        <FormItem prop=\"password\">\r\n          <Poptip trigger=\"focus\" placement=\"right\" width=\"250\">\r\n            <Input type=\"password\" :maxlength=\"20\" v-model=\"form.password\" @on-change=\"strengthChange\" size=\"large\" clearable placeholder=\"请输入密码，长度为6-20个字符\" />\r\n            <div v-bind:class=\"tipStyle\" slot=\"content\">\r\n              <span class=\"words\">强度 : {{strength}}</span>\r\n              <Slider v-model=\"strengthValue\" :step=\"33\" style=\"width:95%\"></Slider>\r\n              请至少输入 6 个字符。请不要使<br>用容易被猜到的密码。\r\n            </div>\r\n          </Poptip>\r\n        </FormItem>\r\n        <FormItem prop=\"confirmPass\">\r\n          <Input type=\"password\" :maxlength=\"20\" v-model=\"form.confirmPass\" size=\"large\" clearable placeholder=\"请再次输入确认密码\" />\r\n        </FormItem>\r\n      </Form>\r\n  \r\n      <Button style=\"margin-bottom:3vh\" type=\"primary\" size=\"large\" :loading=\"loading\" @click=\"submitReset\" long>重置密码</Button>\r\n      <Row type=\"flex\">\r\n        <a @click=\"$router.go(-1)\" class=\"back\">\r\n          <Icon type=\"md-arrow-round-back\" style=\"margin-bottom:3px;\" /> 返回</a>\r\n      </Row>\r\n    </Row>\r\n  \r\n    <Row class=\"foot\">\r\n      <Row type=\"flex\" justify=\"space-around\" class=\"help\">\r\n        <a class=\"item\" href=\"https://github.com/Exrick/x-boot\" target=\"_blank\">帮助</a>\r\n        <a class=\"item\" href=\"https://github.com/Exrick/x-boot\" target=\"_blank\">隐私</a>\r\n        <a class=\"item\" href=\"https://github.com/Exrick/x-boot\" target=\"_blank\">条款</a>\r\n      </Row>\r\n      <Row type=\"flex\" justify=\"center\" class=\"copyright\">\r\n        Copyright © 2018 - Present <a href=\"http://exrick.cn\" target=\"_blank\" style=\"margin:0 5px;\">Exrick</a> 版权所有\r\n      </Row>\r\n    </Row>\r\n    <div id=\"vaptchaContainer\"></div>\r\n    </Col>\r\n  </Row>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  vaptchaID,\r\n  sendResetSms,\r\n  resetByMobile,\r\n  sendResetEmail,\r\n  resetByEmail\r\n} from \"@/api/index\";\r\n\r\nimport common from \"@/libs/common\";\r\n\r\n\r\nimport Cookies from \"js-cookie\";\r\nvar vaptchaObject;\r\nexport default {\r\n  data() {\r\n    const validatePassword = (rule, value, callback) => {\r\n      if (value.length < 6) {\r\n        callback(new Error(\"密码长度不得小于6位\"));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n    const validateConfirmPass = (rule, value, callback) => {\r\n      if (value.length < 6) {\r\n        callback(new Error(\"密码长度不得小于6位\"));\r\n      } else if (value !== this.form.password) {\r\n        callback(new Error(\"两次输入的密码不一致\"));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n    const validateMobile = (rule, value, callback) => {\r\n      var reg = /^[1][3,4,5,6,7,8][0-9]{9}$/;\r\n      if (!reg.test(value)) {\r\n        callback(new Error(\"手机号格式错误\"));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n    return {\r\n      label: \"使用手机号重置密码\",\r\n      icon: \"md-phone-portrait\",\r\n      loading: false,\r\n      type: \"0\",\r\n      form: {\r\n        mobile: \"\",\r\n        email: \"\",\r\n        token: \"\",\r\n        password: \"\",\r\n        passStrength: \"\"\r\n      },\r\n      sended: false,\r\n      sending: false,\r\n      count: 60,\r\n      countButton: \"60 s\",\r\n      tipStyle: \"password-tip-none\",\r\n      strength: \"无\",\r\n      select: \"86\",\r\n      strengthValue: 0,\r\n      errorMobile: \"\",\r\n      errorEmail: \"\",\r\n      rules: {\r\n        mobile: [\r\n          {\r\n            required: true,\r\n            message: \"手机号不能为空\",\r\n            trigger: \"blur\"\r\n          },\r\n          {\r\n            validator: validateMobile,\r\n            trigger: \"blur\"\r\n          }\r\n        ],\r\n        email: [\r\n          {\r\n            required: true,\r\n            message: \"请输入邮箱地址\",\r\n            trigger: \"blur\"\r\n          },\r\n          {\r\n            type: \"email\",\r\n            message: \"邮箱格式不正确\",\r\n            trigger: \"blur\"\r\n          }\r\n        ],\r\n        password: [\r\n          {\r\n            required: true,\r\n            message: \"密码不能为空\",\r\n            trigger: \"blur\"\r\n          },\r\n          {\r\n            validator: validatePassword,\r\n            trigger: \"blur\"\r\n          }\r\n        ],\r\n        code: [\r\n          {\r\n            required: true,\r\n            message: \"验证码不能为空\",\r\n            trigger: \"blur\"\r\n          }\r\n        ],\r\n        confirmPass: [\r\n          {\r\n            required: true,\r\n            message: \"确认密码不能为空\",\r\n            trigger: \"blur\"\r\n          },\r\n          {\r\n            validator: validateConfirmPass,\r\n            trigger: \"blur\"\r\n          }\r\n        ]\r\n      }\r\n    };\r\n  },\r\n  methods: {\r\n    initVaptcha() {\r\n      let that = this;\r\n      vaptcha({\r\n        //配置参数\r\n        vid: vaptchaID, // 验证单元id\r\n        type: \"invisible\" // 展现类型 隐藏式\r\n      }).then(function(vaptchaObj) {\r\n        vaptchaObject = vaptchaObj;\r\n        vaptchaObj.listen(\"pass\", function() {\r\n          that.form.token = vaptchaObj.getToken();\r\n          // 发送验证码\r\n          if (that.type == \"0\") {\r\n            that.sendSmsVerifyCode();\r\n          } else if (that.type == \"1\") {\r\n            that.sendEmailVerifyCode();\r\n          }\r\n        });\r\n      });\r\n    },\r\n    checkStrengthValue(v) {\r\n      // 评级制判断密码强度 最高5\r\n      let grade = 0;\r\n      if (/\\d/.test(v)) {\r\n        grade++; //数字\r\n      }\r\n      if (/[a-z]/.test(v)) {\r\n        grade++; //小写\r\n      }\r\n      if (/[A-Z]/.test(v)) {\r\n        grade++; //大写\r\n      }\r\n      if (/\\W/.test(v)) {\r\n        grade++; //特殊字符\r\n      }\r\n      if (v.length >= 10) {\r\n        grade++;\r\n      }\r\n      return grade;\r\n    },\r\n    strengthChange() {\r\n      if (!this.form.password) {\r\n        this.tipStyle = \"password-tip-none\";\r\n        this.strength = \"无\";\r\n        this.strengthValue = 0;\r\n        return;\r\n      }\r\n      let grade = this.checkStrengthValue(this.form.password);\r\n      if (grade <= 1) {\r\n        this.tipStyle = \"password-tip-weak\";\r\n        this.strength = \"弱\";\r\n        this.strengthValue = 33;\r\n      } else if (grade >= 2 && grade <= 4) {\r\n        this.tipStyle = \"password-tip-middle\";\r\n        this.strength = \"中\";\r\n        this.strengthValue = 66;\r\n      } else {\r\n        this.tipStyle = \"password-tip-strong\";\r\n        this.strength = \"强\";\r\n        this.strengthValue = 100;\r\n      }\r\n    },\r\n    showVaptcha() {\r\n      if (this.type == \"0\") {\r\n        var reg = /^[1][3,4,5,6,7,8][0-9]{9}$/;\r\n        if (!reg.test(this.form.mobile)) {\r\n          this.errorMobile = \"手机号格式错误\";\r\n          return;\r\n        } else {\r\n          this.errorMobile = \"\";\r\n        }\r\n      } else if (this.type == \"1\") {\r\n        var reg = /^[A-Za-z\\d]+([-_.][A-Za-z\\d]+)*@([A-Za-z\\d]+[-.])+[A-Za-z\\d]{2,4}$/;\r\n        if (!reg.test(this.form.email)) {\r\n          this.errorEmail = \"邮箱格式错误\";\r\n          return;\r\n        } else {\r\n          this.errorEmail = \"\";\r\n        }\r\n      }\r\n      vaptchaObject.validate(); // 若没验证验证码 开始验证\r\n    },\r\n    sendSmsVerifyCode() {\r\n      this.sending = true;\r\n      sendResetSms(this.form).then(res => {\r\n        this.sending = false;\r\n        vaptchaObject.reset();\r\n        if (res.success) {\r\n          this.$Message.success(\"发送短信验证码成功\");\r\n          this.sended = true;\r\n          this.countDown();\r\n        }\r\n      });\r\n    },\r\n    sendEmailVerifyCode() {\r\n      this.sending = true;\r\n      sendResetEmail(this.form).then(res => {\r\n        this.sending = false;\r\n        vaptchaObject.reset();\r\n        if (res.success) {\r\n          this.$Message.success(\"发送邮件验证码成功，请注意查收\");\r\n          this.sended = true;\r\n          this.countDown();\r\n        }\r\n      });\r\n    },\r\n    countDown() {\r\n      let that = this;\r\n      if (this.count === 0) {\r\n        this.sended = false;\r\n        this.count = 60;\r\n        return;\r\n      } else {\r\n        this.countButton = this.count + \" s\";\r\n        this.count--;\r\n      }\r\n      setTimeout(function() {\r\n        that.countDown();\r\n      }, 1000);\r\n    },\r\n    submitReset() {\r\n      this.$refs.resetForm.validate(valid => {\r\n        if (valid) {\r\n          this.form.passStrength = this.strength;\r\n          this.loading = true;\r\n          if (this.type == \"0\") {\r\n            resetByMobile(this.form).then(res => {\r\n              this.loading = false;\r\n              if (res.success) {\r\n                this.$Message.success(\"重置密码成功，请牢记您的新密码\");\r\n                this.$router.push({\r\n                  name: \"login\"\r\n                });\r\n              }\r\n            });\r\n          } else if (this.type == \"1\") {\r\n            resetByEmail(this.form).then(res => {\r\n              this.loading = false;\r\n              if (res.success) {\r\n                this.$Message.success(\"重置密码成功，请牢记您的新密码\");\r\n                this.$router.push({\r\n                  name: \"login\"\r\n                });\r\n              }\r\n            });\r\n          }\r\n        }\r\n      });\r\n    }\r\n  },\r\n  mounted() {\r\n    let type = this.$route.query.type;\r\n    if (type == \"1\") {\r\n      this.type = type;\r\n      this.label = \"使用邮箱重置密码\";\r\n      this.icon = \"ios-mail-outline\";\r\n    }\r\n    this.initVaptcha();\r\n    common.initWindowShades();\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n@import \"./reset.less\";\r\n</style>\r\n"],"sourceRoot":"src\\views"}]}
{"remainingRequest":"Z:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\babel-loader\\lib\\index.js!Z:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!Z:\\zeyu\\zeyu-plus\\xboot-plus-front\\src\\views\\sys\\message-manage\\addOrEditMessage.vue?vue&type=script&lang=js&","dependencies":[{"path":"Z:\\zeyu\\zeyu-plus\\xboot-plus-front\\src\\views\\sys\\message-manage\\addOrEditMessage.vue","mtime":1546412367977},{"path":"Z:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1545803981415},{"path":"Z:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\babel-loader\\lib\\index.js","mtime":1529635966000},{"path":"Z:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getUserListData, getMessageDataById, addMessage, editMessage, getDictDataByType, uploadFile } from \"@/api/index\";\nimport E from \"wangeditor\"; // 表情包配置 自定义表情可在该js文件中统一修改\n\nimport { sina } from \"@/libs/emoji\";\nvar editor = null;\n\nvar xss = require(\"xss\");\n\nexport default {\n  name: \"add_edit_message\",\n  data: function data() {\n    var _this = this;\n\n    return {\n      type: 0,\n      loading: false,\n      // 表单加载状态\n      userLoading: true,\n      selectUserCount: 0,\n      selectUsers: [],\n      userModalVisible: false,\n      modalTitle: \"\",\n      // 添加或编辑标题\n      showChooseUser: false,\n      form: {\n        // 添加或编辑表单对象初始化数据\n        title: \"\",\n        content: \"\",\n        type: 0,\n        range: 0\n      },\n      searchUserForm: {\n        username: \"\",\n        type: \"\",\n        status: \"\",\n        pageNumber: 1,\n        // 当前页数\n        pageSize: 9,\n        // 页面大小\n        sort: \"createTime\",\n        // 默认排序字段\n        order: \"desc\" // 默认排序方式\n\n      },\n      formValidate: {\n        // 表单验证规则\n        title: [{\n          required: true,\n          message: \"标题不能为空\",\n          trigger: \"blur\"\n        }],\n        content: [{\n          required: true,\n          message: \"内容不能为空\",\n          trigger: \"blur\"\n        }]\n      },\n      submitLoading: false,\n      // 添加或编辑提交状态\n      userColumns: [{\n        type: \"index\",\n        width: 60,\n        align: \"center\"\n      }, {\n        title: \"用户名\",\n        key: \"username\",\n        width: 145,\n        sortable: true\n      }, {\n        title: \"头像\",\n        key: \"avatar\",\n        width: 80,\n        align: \"center\",\n        render: function render(h, params) {\n          return h(\"Avatar\", {\n            props: {\n              src: params.row.avatar\n            }\n          });\n        }\n      }, {\n        title: \"所属部门\",\n        key: \"departmentTitle\",\n        width: 120\n      }, {\n        title: \"手机\",\n        key: \"mobile\",\n        width: 115,\n        sortable: true\n      }, {\n        title: \"邮箱\",\n        key: \"email\",\n        width: 180,\n        sortable: true\n      }, {\n        title: \"性别\",\n        key: \"sex\",\n        width: 70,\n        align: \"center\",\n        render: function render(h, params) {\n          var re = \"\";\n\n          _this.dictSex.forEach(function (e) {\n            if (e.value == params.row.sex) {\n              re = e.title;\n            }\n          });\n\n          return h(\"div\", re);\n        }\n      }, {\n        title: \"用户类型\",\n        key: \"type\",\n        align: \"center\",\n        width: 100,\n        render: function render(h, params) {\n          var re = \"\";\n\n          if (params.row.type === 1) {\n            re = \"管理员\";\n          } else if (params.row.type === 0) {\n            re = \"普通用户\";\n          }\n\n          return h(\"div\", re);\n        }\n      }, {\n        title: \"状态\",\n        key: \"status\",\n        align: \"center\",\n        width: 120,\n        render: function render(h, params) {\n          if (params.row.status === 0) {\n            return h(\"div\", [h(\"Tag\", {\n              props: {\n                color: \"green\"\n              }\n            }, \"正常启用\")]);\n          } else if (params.row.status === -1) {\n            return h(\"div\", [h(\"Tag\", {\n              props: {\n                color: \"red\"\n              }\n            }, \"禁用\")]);\n          }\n        }\n      }, {\n        title: \"创建时间\",\n        key: \"createTime\",\n        sortable: true,\n        sortType: \"desc\",\n        width: 150\n      }, {\n        title: \"操作\",\n        key: \"action\",\n        width: 130,\n        align: \"center\",\n        fixed: \"right\",\n        render: function render(h, params) {\n          return h(\"div\", [h(\"Button\", {\n            props: {\n              type: \"info\",\n              size: \"small\"\n            },\n            on: {\n              click: function click() {\n                _this.chooseUser(params.row);\n              }\n            }\n          }, \"添加该用户\")]);\n        }\n      }],\n      userData: [],\n      totalUser: 0,\n      dictMessageType: [],\n      dictSex: [],\n      dataEdit: \"\",\n      // 编辑数据\n      showHTMLModal: false,\n      // 显示html\n      full: false,\n      // html全屏开关\n      fullscreenModal: false,\n      // 显示全屏预览\n      backRoute: \"\"\n    };\n  },\n  methods: {\n    init: function init() {\n      this.getUserDataList();\n      this.getDictDataType();\n      this.initEditor();\n      this.type = this.$route.query.type;\n      this.backRoute = this.$route.query.backRoute;\n\n      if (this.type == 1) {\n        this.form.id = this.$route.query.id;\n        this.getData();\n      }\n    },\n    initEditor: function initEditor() {\n      var _this2 = this;\n\n      var that = this;\n      editor = new E(this.$refs.editor);\n\n      editor.customConfig.onchange = function (html) {\n        _this2.form.content = xss(html);\n      };\n\n      editor.customConfig.uploadImgServer = uploadFile;\n      editor.customConfig.uploadImgHeaders = {\n        accessToken: that.getStore(\"accessToken\")\n      };\n      editor.customConfig.uploadFileName = \"file\";\n      editor.customConfig.uploadImgHooks = {\n        before: function before(xhr, editor, files) {},\n        success: function success(xhr, editor, result) {},\n        fail: function fail(xhr, editor, result) {\n          that.$Message.error(\"上传图片失败\");\n        },\n        error: function error(xhr, editor) {\n          that.$Message.error(\"上传图片出错\");\n        },\n        timeout: function timeout(xhr, editor) {\n          that.$Message.error(\"上传图片超时\");\n        },\n        customInsert: function customInsert(insertImg, result, editor) {\n          if (result.success === true) {\n            var url = result.result;\n            insertImg(url);\n            that.$Message.success(\"上传图片成功\");\n          } else {\n            that.$Message.error(result.message);\n          }\n        }\n      };\n      editor.customConfig.fontNames = [\"微软雅黑\", \"宋体\", \"黑体\", \"Arial\"];\n      editor.customConfig.emotions = [{\n        title: \"新浪\",\n        type: \"image\",\n        content: sina\n      }];\n      editor.create();\n    },\n    editHTML: function editHTML() {\n      this.dataEdit = this.form.content;\n      this.showHTMLModal = true;\n    },\n    editHTMLOk: function editHTMLOk() {\n      editor.txt.html(this.dataEdit);\n      this.form.content = xss(this.dataEdit);\n      this.showHTMLModal = false;\n    },\n    getDictDataType: function getDictDataType() {\n      var _this3 = this;\n\n      getDictDataByType(\"message_type\").then(function (res) {\n        if (res.success) {\n          _this3.dictMessageType = res.result;\n        }\n      }); // 获取性别字典数据\n\n      getDictDataByType(\"sex\").then(function (res) {\n        if (res.success) {\n          _this3.dictSex = res.result;\n        }\n      });\n    },\n    getData: function getData() {\n      var _this4 = this;\n\n      this.loading = true;\n      getMessageDataById(this.form.id).then(function (res) {\n        _this4.loading = false;\n\n        if (res.success === true) {\n          // 转换null为\"\"\n          var v = res.result;\n\n          for (var attr in v) {\n            if (v[attr] === null) {\n              v[attr] = \"\";\n            }\n          }\n\n          var str = JSON.stringify(v);\n          var data = JSON.parse(str);\n          editor.txt.html(data.content);\n          _this4.form = data;\n        }\n      });\n    },\n    changeUserPage: function changeUserPage(v) {\n      this.searchUserForm.pageNumber = v;\n      this.getUserDataList();\n    },\n    changeUserPageSize: function changeUserPageSize(v) {\n      this.searchUserForm.pageSize = v;\n      this.getUserDataList();\n    },\n    getUserDataList: function getUserDataList() {\n      var _this5 = this;\n\n      this.userLoading = true;\n      getUserListData(this.searchUserForm).then(function (res) {\n        _this5.userLoading = false;\n\n        if (res.success === true) {\n          _this5.userData = res.result.content;\n          _this5.totalUser = res.result.totalElements;\n        }\n      });\n    },\n    handleSearchUser: function handleSearchUser() {\n      this.searchUserForm.pageNumber = 1;\n      this.searchUserForm.pageSize = 9;\n      this.getUserDataList();\n    },\n    handleResetUser: function handleResetUser() {\n      this.$refs.searchUserForm.resetFields();\n      this.searchUserForm.pageNumber = 1;\n      this.searchUserForm.pageSize = 9; // 重新加载数据\n\n      this.getUserDataList();\n    },\n    handelSubmit: function handelSubmit() {\n      var _this6 = this;\n\n      this.$refs.form.validate(function (valid) {\n        if (valid) {\n          _this6.submitLoading = true;\n\n          if (_this6.type === 0) {\n            // 添加 避免编辑后传入id等数据 记得删除\n            delete _this6.form.id; // 用户id数据\n\n            var ids = [];\n\n            _this6.selectUsers.forEach(function (e) {\n              ids += e.id + \",\";\n            });\n\n            if (ids.length > 0) {\n              ids = ids.substring(0, ids.length - 1);\n            }\n\n            _this6.form.userIds = ids;\n            addMessage(_this6.form).then(function (res) {\n              _this6.submitLoading = false;\n\n              if (res.success === true) {\n                _this6.$Message.success(\"操作成功\");\n\n                _this6.closeCurrentPage();\n              }\n            });\n          } else if (_this6.type === 1) {\n            // 编辑\n            editMessage(_this6.form).then(function (res) {\n              _this6.submitLoading = false;\n\n              if (res.success === true) {\n                _this6.$Message.success(\"操作成功\");\n\n                _this6.closeCurrentPage();\n              }\n            });\n          }\n        }\n      });\n    },\n    changeRange: function changeRange(v) {\n      if (v == 0) {\n        this.showChooseUser = false;\n        this.selectUserCount = this.totalUser;\n      } else {\n        this.showChooseUser = true;\n        this.clearSelectAllUser();\n      }\n    },\n    chooseUser: function chooseUser(v) {\n      // 去重\n      var that = this;\n      var flag = true;\n      this.selectUsers.forEach(function (e) {\n        if (v.id == e.id) {\n          that.$Message.warning(\"刚才已经选择过啦，请勿重复选择\");\n          flag = false;\n        }\n      });\n\n      if (flag) {\n        var u = {\n          id: v.id,\n          username: v.username\n        };\n        this.selectUsers.push(u);\n        this.selectUserCount += 1;\n        this.$Message.success(\"选择成功\");\n      }\n    },\n    handleCancelUser: function handleCancelUser(e, id) {\n      // 删除所选用户\n      var newArray = [];\n      this.selectUsers.forEach(function (e) {\n        if (id != e.id) {\n          newArray.push(e);\n        }\n      });\n      this.selectUsers = newArray;\n      this.selectUserCount = newArray.length;\n      this.$Message.success(\"删除所选用户成功\");\n    },\n    clearSelectAllUser: function clearSelectAllUser() {\n      this.selectUserCount = 0;\n      this.selectUsers = [];\n    },\n    handelCancel: function handelCancel() {\n      this.closeCurrentPage();\n    },\n    // 关闭当前页面\n    closeCurrentPage: function closeCurrentPage() {\n      this.$store.commit(\"removeTag\", \"add_edit_message\");\n      localStorage.pageOpenedList = JSON.stringify(this.$store.state.app.pageOpenedList);\n      this.$router.push({\n        name: this.backRoute\n      });\n    }\n  },\n  mounted: function mounted() {\n    this.init();\n  },\n  watch: {\n    // 监听路由变化\n    $route: function $route(to, from) {\n      if (to.name == \"add_edit_message\") {\n        this.type = this.$route.query.type;\n\n        if (this.type == 1) {\n          this.form.id = this.$route.query.id;\n          this.getData();\n        }\n      }\n    }\n  }\n};",{"version":3,"sources":["addOrEditMessage.vue"],"names":[],"mappings":"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","sourcesContent":["<style lang=\"less\">\r\n@import \"./messageManage.less\";\r\n</style>\r\n<template>\r\n  <div class=\"search\">\r\n    <Row>\r\n      <Col>\r\n        <Card>\r\n          <p slot=\"title\">\r\n            <span v-if=\"type==0\">发送新消息</span>\r\n            <span v-else>编辑消息</span>\r\n          </p>\r\n          <Row>\r\n            <Form\r\n              ref=\"form\"\r\n              :model=\"form\"\r\n              :label-width=\"70\"\r\n              :rules=\"formValidate\"\r\n              style=\"position:relative\"\r\n            >\r\n              <FormItem label=\"消息类型\" prop=\"type\">\r\n                <Select v-model=\"form.type\" placeholder=\"请选择\" style=\"width:250px\">\r\n                  <Option\r\n                    v-for=\"(item, i) in dictMessageType\"\r\n                    :key=\"i\"\r\n                    :value=\"Number(item.value)\"\r\n                  >{{item.title}}</Option>\r\n                </Select>\r\n              </FormItem>\r\n              <FormItem label=\"标题\" prop=\"title\">\r\n                <Input v-model=\"form.title\" style=\"width:600px\"/>\r\n              </FormItem>\r\n              <FormItem label=\"内容\" prop=\"content\">\r\n                <div ref=\"editor\"></div>\r\n              </FormItem>\r\n              <Form-item label class=\"br\">\r\n                <Button @click=\"editHTML\" icon=\"ios-create-outline\">编辑HTML代码</Button>\r\n                <Button @click=\"fullscreenModal=true\" icon=\"md-eye\">全屏预览</Button>\r\n              </Form-item>\r\n              <FormItem label=\"新创建账号也推送\" prop=\"createSend\">\r\n                <i-switch size=\"large\" v-model=\"form.createSend\">\r\n                  <span slot=\"open\">开启</span>\r\n                  <span slot=\"close\">关闭</span>\r\n                </i-switch>\r\n              </FormItem>\r\n              <div v-if=\"type==0\">\r\n                <FormItem label=\"发送范围\">\r\n                  <RadioGroup v-model=\"form.range\" @on-change=\"changeRange\">\r\n                    <Radio :label=\"0\">全体用户</Radio>\r\n                    <Radio :label=\"1\">指定用户成员</Radio>\r\n                  </RadioGroup>\r\n                </FormItem>\r\n                <div>\r\n                  <FormItem label=\"选择用户\" v-if=\"showChooseUser\">\r\n                    <Button @click=\"userModalVisible=true\" icon=\"md-person-add\">选择发送用户</Button>\r\n                  </FormItem>\r\n                  <FormItem label>\r\n                    <Collapse simple>\r\n                      <Panel name=\"1\">已选择\r\n                        <span class=\"select-count\">{{selectUserCount}}</span> 人\r\n                        <p slot=\"content\" v-if=\"showChooseUser\">\r\n                          <Tag\r\n                            v-for=\"(item, i) in selectUsers\"\r\n                            :key=\"i\"\r\n                            :name=\"item.id\"\r\n                            color=\"default\"\r\n                            closable\r\n                            @on-close=\"handleCancelUser\"\r\n                          >{{item.username}}</Tag>\r\n                        </p>\r\n                        <p slot=\"content\" v-else>\r\n                          <span>所有用户</span>\r\n                        </p>\r\n                      </Panel>\r\n                    </Collapse>\r\n                  </FormItem>\r\n                </div>\r\n              </div>\r\n              <Form-item class=\"br\">\r\n                <Button\r\n                  type=\"primary\"\r\n                  :loading=\"submitLoading\"\r\n                  @click=\"handelSubmit\"\r\n                  style=\"width:100px\"\r\n                >提交</Button>\r\n                <Button @click=\"handelCancel\">取消</Button>\r\n              </Form-item>\r\n              <Spin size=\"large\" fix v-if=\"loading\"></Spin>\r\n            </Form>\r\n          </Row>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n    <!-- Drawer抽屉式选择用户 -->\r\n    <Drawer title=\"选择用户\" closable v-model=\"userModalVisible\" width=\"800\">\r\n      <Form\r\n        ref=\"searchUserForm\"\r\n        :model=\"searchUserForm\"\r\n        inline\r\n        :label-width=\"55\"\r\n        class=\"search-form\"\r\n      >\r\n        <Form-item label=\"用户名\" prop=\"username\">\r\n          <Input\r\n            type=\"text\"\r\n            v-model=\"searchUserForm.username\"\r\n            clearable\r\n            placeholder=\"请输入用户名\"\r\n            style=\"width: 200px\"\r\n          />\r\n        </Form-item>\r\n        <Form-item style=\"margin-left:-35px;\" class=\"br\">\r\n          <Button @click=\"handleSearchUser\" type=\"primary\" icon=\"ios-search\">搜索</Button>\r\n          <Button @click=\"handleResetUser\">重置</Button>\r\n        </Form-item>\r\n      </Form>\r\n      <Table :loading=\"userLoading\" border :columns=\"userColumns\" :data=\"userData\" ref=\"userTable\"></Table>\r\n      <Row type=\"flex\" justify=\"end\" class=\"code-row-bg page\" style=\"margin: 10px 0;\">\r\n        <Page\r\n          :current=\"searchUserForm.pageNumber\"\r\n          :total=\"totalUser\"\r\n          :page-size=\"searchUserForm.pageSize\"\r\n          @on-change=\"changeUserPage\"\r\n          @on-page-size-change=\"changeUserPageSize\"\r\n          :page-size-opts=\"[9,18,36]\"\r\n          size=\"small\"\r\n          show-total\r\n          show-elevator\r\n          show-sizer\r\n        ></Page>\r\n      </Row>\r\n      <div class=\"drawer-footer\">已选择\r\n        <span class=\"select-count\">{{selectUserCount}}</span> 人\r\n        <Button @click=\"clearSelectAllUser\" style=\"margin-left:10px\">清空已选</Button>\r\n        <Button @click=\"userModalVisible=false\" style=\"margin-left:5px\" type=\"primary\">关闭</Button>\r\n      </div>\r\n    </Drawer>\r\n    <!-- html编辑 -->\r\n    <Modal\r\n      title=\"编辑html代码\"\r\n      v-model=\"showHTMLModal\"\r\n      :mask-closable=\"false\"\r\n      :width=\"900\"\r\n      :fullscreen=\"full\"\r\n    >\r\n      <Input\r\n        v-if=\"!full\"\r\n        v-model=\"dataEdit\"\r\n        :autosize=\"true\"\r\n        type=\"textarea\"\r\n        style=\"max-height:60vh;overflow:auto\"\r\n      />\r\n      <Input v-if=\"full\" v-model=\"dataEdit\" :autosize=\"true\" type=\"textarea\"/>\r\n      <div slot=\"footer\">\r\n        <Button @click=\"full=!full\" icon=\"md-expand\">全屏开/关</Button>\r\n        <Button @click=\"editHTMLOk\" type=\"primary\" icon=\"md-checkmark-circle-outline\">确定保存</Button>\r\n      </div>\r\n    </Modal>\r\n    <Modal title=\"预览\" v-model=\"fullscreenModal\" fullscreen>\r\n      <div v-html=\"form.content\">{{form.content}}</div>\r\n      <div slot=\"footer\">\r\n        <Button @click=\"fullscreenModal=false\">关闭</Button>\r\n      </div>\r\n    </Modal>\r\n    <!-- Modal弹出式选择用户 -->\r\n    <!-- <Modal title=\"选择用户\" v-model=\"userModalVisible\" :width=\"1200\" :styles=\"{top: '30px'}\">\r\n      <Form ref=\"searchUserForm\" :model=\"searchUserForm\" inline :label-width=\"70\" class=\"search-form\">\r\n        <Form-item label=\"搜索用户\" prop=\"username\">\r\n          <Input type=\"text\" v-model=\"searchUserForm.username\" clearable placeholder=\"请输入用户名\" style=\"width: 250px\"/>\r\n        </Form-item>\r\n        <Form-item style=\"margin-left:-35px;\" class=\"br\">\r\n          <Button @click=\"handleSearchUser\" type=\"primary\" icon=\"ios-search\">搜索</Button>\r\n          <Button @click=\"handleResetUser\">重置</Button>\r\n        </Form-item>\r\n      </Form>\r\n      <Table :loading=\"userLoading\" border :columns=\"userColumns\" :data=\"userData\" ref=\"userTable\"></Table>\r\n      <Row type=\"flex\" justify=\"end\" class=\"code-row-bg page\" style=\"margin-top: 10px;\">\r\n        <Page :current=\"searchUserForm.pageNumber\" :total=\"total\" :page-size=\"searchUserForm.pageSize\" @on-change=\"changeUserPage\" @on-page-size-change=\"changeUserPageSize\" :page-size-opts=\"[9,18,36]\" size=\"small\" show-total show-elevator show-sizer></Page>\r\n      </Row>\r\n      <div slot=\"footer\">\r\n        已选择 <span class=\"select-count\">{{selectUserCount}}</span> 人\r\n        <Button @click=\"clearSelectAllUser\" style=\"margin-left:10px\">清空已选</Button>\r\n        <Button @click=\"userModalVisible=false\" style=\"margin-left:5px\" type=\"primary\">关闭</Button>\r\n      </div>\r\n    </Modal>-->\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getUserListData,\r\n  getMessageDataById,\r\n  addMessage,\r\n  editMessage,\r\n  getDictDataByType,\r\n  uploadFile\r\n} from \"@/api/index\";\r\nimport E from \"wangeditor\";\r\n// 表情包配置 自定义表情可在该js文件中统一修改\r\nimport { sina } from \"@/libs/emoji\";\r\nlet editor = null;\r\nvar xss = require(\"xss\");\r\nexport default {\r\n  name: \"add_edit_message\",\r\n  data() {\r\n    return {\r\n      type: 0,\r\n      loading: false, // 表单加载状态\r\n      userLoading: true,\r\n      selectUserCount: 0,\r\n      selectUsers: [],\r\n      userModalVisible: false,\r\n      modalTitle: \"\", // 添加或编辑标题\r\n      showChooseUser: false,\r\n      form: {\r\n        // 添加或编辑表单对象初始化数据\r\n        title: \"\",\r\n        content: \"\",\r\n        type: 0,\r\n        range: 0\r\n      },\r\n      searchUserForm: {\r\n        username: \"\",\r\n        type: \"\",\r\n        status: \"\",\r\n        pageNumber: 1, // 当前页数\r\n        pageSize: 9, // 页面大小\r\n        sort: \"createTime\", // 默认排序字段\r\n        order: \"desc\" // 默认排序方式\r\n      },\r\n      formValidate: {\r\n        // 表单验证规则\r\n        title: [{ required: true, message: \"标题不能为空\", trigger: \"blur\" }],\r\n        content: [{ required: true, message: \"内容不能为空\", trigger: \"blur\" }]\r\n      },\r\n      submitLoading: false, // 添加或编辑提交状态\r\n      userColumns: [\r\n        {\r\n          type: \"index\",\r\n          width: 60,\r\n          align: \"center\"\r\n        },\r\n        {\r\n          title: \"用户名\",\r\n          key: \"username\",\r\n          width: 145,\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"头像\",\r\n          key: \"avatar\",\r\n          width: 80,\r\n          align: \"center\",\r\n          render: (h, params) => {\r\n            return h(\"Avatar\", {\r\n              props: {\r\n                src: params.row.avatar\r\n              }\r\n            });\r\n          }\r\n        },\r\n        {\r\n          title: \"所属部门\",\r\n          key: \"departmentTitle\",\r\n          width: 120\r\n        },\r\n        {\r\n          title: \"手机\",\r\n          key: \"mobile\",\r\n          width: 115,\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"邮箱\",\r\n          key: \"email\",\r\n          width: 180,\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"性别\",\r\n          key: \"sex\",\r\n          width: 70,\r\n          align: \"center\",\r\n          render: (h, params) => {\r\n            let re = \"\";\r\n            this.dictSex.forEach(e => {\r\n              if (e.value == params.row.sex) {\r\n                re = e.title;\r\n              }\r\n            });\r\n            return h(\"div\", re);\r\n          }\r\n        },\r\n        {\r\n          title: \"用户类型\",\r\n          key: \"type\",\r\n          align: \"center\",\r\n          width: 100,\r\n          render: (h, params) => {\r\n            let re = \"\";\r\n            if (params.row.type === 1) {\r\n              re = \"管理员\";\r\n            } else if (params.row.type === 0) {\r\n              re = \"普通用户\";\r\n            }\r\n            return h(\"div\", re);\r\n          }\r\n        },\r\n        {\r\n          title: \"状态\",\r\n          key: \"status\",\r\n          align: \"center\",\r\n          width: 120,\r\n          render: (h, params) => {\r\n            if (params.row.status === 0) {\r\n              return h(\"div\", [\r\n                h(\r\n                  \"Tag\",\r\n                  {\r\n                    props: {\r\n                      color: \"green\"\r\n                    }\r\n                  },\r\n                  \"正常启用\"\r\n                )\r\n              ]);\r\n            } else if (params.row.status === -1) {\r\n              return h(\"div\", [\r\n                h(\r\n                  \"Tag\",\r\n                  {\r\n                    props: {\r\n                      color: \"red\"\r\n                    }\r\n                  },\r\n                  \"禁用\"\r\n                )\r\n              ]);\r\n            }\r\n          }\r\n        },\r\n        {\r\n          title: \"创建时间\",\r\n          key: \"createTime\",\r\n          sortable: true,\r\n          sortType: \"desc\",\r\n          width: 150\r\n        },\r\n        {\r\n          title: \"操作\",\r\n          key: \"action\",\r\n          width: 130,\r\n          align: \"center\",\r\n          fixed: \"right\",\r\n          render: (h, params) => {\r\n            return h(\"div\", [\r\n              h(\r\n                \"Button\",\r\n                {\r\n                  props: {\r\n                    type: \"info\",\r\n                    size: \"small\"\r\n                  },\r\n                  on: {\r\n                    click: () => {\r\n                      this.chooseUser(params.row);\r\n                    }\r\n                  }\r\n                },\r\n                \"添加该用户\"\r\n              )\r\n            ]);\r\n          }\r\n        }\r\n      ],\r\n      userData: [],\r\n      totalUser: 0,\r\n      dictMessageType: [],\r\n      dictSex: [],\r\n      dataEdit: \"\", // 编辑数据\r\n      showHTMLModal: false, // 显示html\r\n      full: false, // html全屏开关\r\n      fullscreenModal: false, // 显示全屏预览\r\n      backRoute: \"\"\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.getUserDataList();\r\n      this.getDictDataType();\r\n      this.initEditor();\r\n      this.type = this.$route.query.type;\r\n      this.backRoute = this.$route.query.backRoute;\r\n      if (this.type == 1) {\r\n        this.form.id = this.$route.query.id;\r\n        this.getData();\r\n      }\r\n    },\r\n    initEditor() {\r\n      let that = this;\r\n      editor = new E(this.$refs.editor);\r\n      editor.customConfig.onchange = html => {\r\n        this.form.content = xss(html);\r\n      };\r\n      editor.customConfig.uploadImgServer = uploadFile;\r\n      editor.customConfig.uploadImgHeaders = {\r\n        accessToken: that.getStore(\"accessToken\")\r\n      };\r\n      editor.customConfig.uploadFileName = \"file\";\r\n      editor.customConfig.uploadImgHooks = {\r\n        before: function(xhr, editor, files) {},\r\n        success: function(xhr, editor, result) {},\r\n        fail: function(xhr, editor, result) {\r\n          that.$Message.error(\"上传图片失败\");\r\n        },\r\n        error: function(xhr, editor) {\r\n          that.$Message.error(\"上传图片出错\");\r\n        },\r\n        timeout: function(xhr, editor) {\r\n          that.$Message.error(\"上传图片超时\");\r\n        },\r\n        customInsert: function(insertImg, result, editor) {\r\n          if (result.success === true) {\r\n            let url = result.result;\r\n            insertImg(url);\r\n            that.$Message.success(\"上传图片成功\");\r\n          } else {\r\n            that.$Message.error(result.message);\r\n          }\r\n        }\r\n      };\r\n      editor.customConfig.fontNames = [\"微软雅黑\", \"宋体\", \"黑体\", \"Arial\"];\r\n      editor.customConfig.emotions = [\r\n        {\r\n          title: \"新浪\",\r\n          type: \"image\",\r\n          content: sina\r\n        }\r\n      ];\r\n      editor.create();\r\n    },\r\n    editHTML() {\r\n      this.dataEdit = this.form.content;\r\n      this.showHTMLModal = true;\r\n    },\r\n    editHTMLOk() {\r\n      editor.txt.html(this.dataEdit);\r\n      this.form.content = xss(this.dataEdit);\r\n      this.showHTMLModal = false;\r\n    },\r\n    getDictDataType() {\r\n      getDictDataByType(\"message_type\").then(res => {\r\n        if (res.success) {\r\n          this.dictMessageType = res.result;\r\n        }\r\n      });\r\n      // 获取性别字典数据\r\n      getDictDataByType(\"sex\").then(res => {\r\n        if (res.success) {\r\n          this.dictSex = res.result;\r\n        }\r\n      });\r\n    },\r\n    getData() {\r\n      this.loading = true;\r\n      getMessageDataById(this.form.id).then(res => {\r\n        this.loading = false;\r\n        if (res.success === true) {\r\n          // 转换null为\"\"\r\n          let v = res.result;\r\n          for (let attr in v) {\r\n            if (v[attr] === null) {\r\n              v[attr] = \"\";\r\n            }\r\n          }\r\n          let str = JSON.stringify(v);\r\n          let data = JSON.parse(str);\r\n          editor.txt.html(data.content);\r\n          this.form = data;\r\n        }\r\n      });\r\n    },\r\n    changeUserPage(v) {\r\n      this.searchUserForm.pageNumber = v;\r\n      this.getUserDataList();\r\n    },\r\n    changeUserPageSize(v) {\r\n      this.searchUserForm.pageSize = v;\r\n      this.getUserDataList();\r\n    },\r\n    getUserDataList() {\r\n      this.userLoading = true;\r\n      getUserListData(this.searchUserForm).then(res => {\r\n        this.userLoading = false;\r\n        if (res.success === true) {\r\n          this.userData = res.result.content;\r\n          this.totalUser = res.result.totalElements;\r\n        }\r\n      });\r\n    },\r\n    handleSearchUser() {\r\n      this.searchUserForm.pageNumber = 1;\r\n      this.searchUserForm.pageSize = 9;\r\n      this.getUserDataList();\r\n    },\r\n    handleResetUser() {\r\n      this.$refs.searchUserForm.resetFields();\r\n      this.searchUserForm.pageNumber = 1;\r\n      this.searchUserForm.pageSize = 9;\r\n      // 重新加载数据\r\n      this.getUserDataList();\r\n    },\r\n    handelSubmit() {\r\n      this.$refs.form.validate(valid => {\r\n        if (valid) {\r\n          this.submitLoading = true;\r\n          if (this.type === 0) {\r\n            // 添加 避免编辑后传入id等数据 记得删除\r\n            delete this.form.id;\r\n            // 用户id数据\r\n            let ids = [];\r\n            this.selectUsers.forEach(e => {\r\n              ids += e.id + \",\";\r\n            });\r\n            if (ids.length > 0) {\r\n              ids = ids.substring(0, ids.length - 1);\r\n            }\r\n            this.form.userIds = ids;\r\n            addMessage(this.form).then(res => {\r\n              this.submitLoading = false;\r\n              if (res.success === true) {\r\n                this.$Message.success(\"操作成功\");\r\n                this.closeCurrentPage();\r\n              }\r\n            });\r\n          } else if (this.type === 1) {\r\n            // 编辑\r\n            editMessage(this.form).then(res => {\r\n              this.submitLoading = false;\r\n              if (res.success === true) {\r\n                this.$Message.success(\"操作成功\");\r\n                this.closeCurrentPage();\r\n              }\r\n            });\r\n          }\r\n        }\r\n      });\r\n    },\r\n    changeRange(v) {\r\n      if (v == 0) {\r\n        this.showChooseUser = false;\r\n        this.selectUserCount = this.totalUser;\r\n      } else {\r\n        this.showChooseUser = true;\r\n        this.clearSelectAllUser();\r\n      }\r\n    },\r\n    chooseUser(v) {\r\n      // 去重\r\n      let that = this;\r\n      let flag = true;\r\n      this.selectUsers.forEach(e => {\r\n        if (v.id == e.id) {\r\n          that.$Message.warning(\"刚才已经选择过啦，请勿重复选择\");\r\n          flag = false;\r\n        }\r\n      });\r\n      if (flag) {\r\n        let u = {\r\n          id: v.id,\r\n          username: v.username\r\n        };\r\n        this.selectUsers.push(u);\r\n        this.selectUserCount += 1;\r\n        this.$Message.success(\"选择成功\");\r\n      }\r\n    },\r\n    handleCancelUser(e, id) {\r\n      // 删除所选用户\r\n      let newArray = [];\r\n      this.selectUsers.forEach(e => {\r\n        if (id != e.id) {\r\n          newArray.push(e);\r\n        }\r\n      });\r\n      this.selectUsers = newArray;\r\n      this.selectUserCount = newArray.length;\r\n      this.$Message.success(\"删除所选用户成功\");\r\n    },\r\n    clearSelectAllUser() {\r\n      this.selectUserCount = 0;\r\n      this.selectUsers = [];\r\n    },\r\n    handelCancel() {\r\n      this.closeCurrentPage();\r\n    },\r\n    // 关闭当前页面\r\n    closeCurrentPage() {\r\n      this.$store.commit(\"removeTag\", \"add_edit_message\");\r\n      localStorage.pageOpenedList = JSON.stringify(\r\n        this.$store.state.app.pageOpenedList\r\n      );\r\n      this.$router.push({\r\n        name: this.backRoute\r\n      });\r\n    }\r\n  },\r\n  mounted() {\r\n    this.init();\r\n  },\r\n  watch: {\r\n    // 监听路由变化\r\n    $route(to, from) {\r\n      if (to.name == \"add_edit_message\") {\r\n        this.type = this.$route.query.type;\r\n        if (this.type == 1) {\r\n          this.form.id = this.$route.query.id;\r\n          this.getData();\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>"],"sourceRoot":"src\\views\\sys\\message-manage"}]}
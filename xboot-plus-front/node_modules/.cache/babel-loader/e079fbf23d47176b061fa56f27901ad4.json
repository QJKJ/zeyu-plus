{"remainingRequest":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\babel-loader\\lib\\index.js!D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\zeyu\\zeyu-plus\\xboot-plus-front\\src\\views\\xboot-vue-template\\excel\\excel.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\src\\views\\xboot-vue-template\\excel\\excel.vue","mtime":1545792990786},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1545803981415},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\babel-loader\\lib\\index.js","mtime":1529635966000},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// 模版导入文件表数据\nimport { userColumns, userData } from \"@/libs/importTemplate\"; // excel转换工具类\n\nimport excel from \"@/libs/excel\";\nexport default {\n  name: \"excel\",\n  data: function data() {\n    var _this = this;\n\n    return {\n      loading: true,\n      // 表单加载状态\n      importLoading: false,\n      // 导入加载状态\n      loadingExport: true,\n      // 导出加载状态\n      exportModalVisible: false,\n      // 自定义导出显示\n      importModalVisible: false,\n      // 导入显示\n      selectCount: 0,\n      // 多选计数\n      selectList: [],\n      // 多选数据\n      searchForm: {\n        pageNumber: 1,\n        pageSize: 10,\n        sort: \"createTime\",\n        order: \"desc\"\n      },\n      columns: [// 表头\n      {\n        type: \"selection\",\n        width: 60,\n        align: \"center\"\n      }, {\n        type: \"index\",\n        width: 60,\n        align: \"center\"\n      }, {\n        title: \"名称\",\n        key: \"name\",\n        sortable: true\n      }, {\n        title: \"手机\",\n        key: \"mobile\",\n        sortable: true\n      }, {\n        title: \"创建时间\",\n        key: \"createTime\",\n        sortable: true,\n        sortType: \"desc\"\n      }, {\n        title: \"更新时间\",\n        key: \"updateTime\",\n        sortable: true\n      }, {\n        title: \"操作\",\n        key: \"action\",\n        align: \"center\",\n        render: function render(h, params) {\n          return h(\"div\", [h(\"Button\", {\n            props: {\n              type: \"primary\",\n              size: \"small\",\n              icon: \"ios-create-outline\"\n            },\n            style: {\n              marginRight: \"5px\"\n            },\n            on: {\n              click: function click() {\n                _this.$Message.info(\"点击了编辑\");\n              }\n            }\n          }, \"编辑\"), h(\"Button\", {\n            props: {\n              type: \"error\",\n              size: \"small\",\n              icon: \"md-trash\"\n            },\n            on: {\n              click: function click() {\n                _this.$Message.info(\"点击了删除\");\n              }\n            }\n          }, \"删除\")]);\n        }\n      }],\n      exportColumns: [// 导出列\n      {\n        title: \"名称\",\n        key: \"name\",\n        sortable: true\n      }, {\n        title: \"手机\",\n        key: \"mobile\",\n        sortable: true\n      }, {\n        title: \"创建时间\",\n        key: \"createTime\",\n        sortable: true,\n        sortType: \"desc\"\n      }, {\n        title: \"更新时间\",\n        key: \"updateTime\",\n        sortable: true\n      }],\n      chooseColumns: [],\n      filename: \"数据\",\n      exportTitle: \"确认导出\",\n      exportType: \"\",\n      importTableData: [],\n      importColumns: [],\n      uploadfile: {\n        name: \"\"\n      },\n      tempColumns: userColumns,\n      tempData: userData,\n      data: [],\n      exportData: [],\n      total: 0\n    };\n  },\n  methods: {\n    init: function init() {\n      var _this2 = this;\n\n      this.getDataList(); // 初始化导出列数据\n\n      var array = [];\n      this.exportColumns.forEach(function (e) {\n        // 指定列限制权限\n        if (!_this2.getStore(\"roles\").includes(\"ROLE_ADMIN\") && e.key === \"mobile\") {\n          e.title = \"[无权导出] \" + e.title;\n          e.disabled = true;\n        } else {\n          e.disabled = false;\n        }\n\n        array.push(e.title);\n      });\n      this.chooseColumns = array;\n    },\n    changePage: function changePage(v) {\n      this.searchForm.pageNumber = v;\n      this.getDataList();\n      this.clearSelectAll();\n    },\n    changePageSize: function changePageSize(v) {\n      this.searchForm.pageSize = v;\n      this.getDataList();\n    },\n    selectDateRange: function selectDateRange(v) {\n      if (v) {\n        this.searchForm.startDate = v[0];\n        this.searchForm.endDate = v[1];\n      }\n    },\n    getDataList: function getDataList() {\n      this.loading = true;\n      var params = {\n        pageNumber: this.pageNumber,\n        pageSize: this.pageSize,\n        sort: this.sortColumn,\n        order: this.sortType\n      }; // 请求后端获取表单数据 请自行修改接口\n      // this.getRequest(\"请求路径\", params).then(res => {\n      //   this.loading = false;\n      //   if (res.success === true) {\n      //     this.data = res.result.content;\n      //     this.total = res.result.totalElements;\n      //   }\n      // });\n      // 以下为模拟数据\n\n      this.data = [{\n        id: \"1\",\n        name: \"X-BOOT\",\n        mobile: \"12345678901\",\n        createTime: \"2018-08-08 00:08:00\",\n        updateTime: \"2018-08-08 00:08:00\"\n      }, {\n        id: \"2\",\n        name: \"Exrick\",\n        mobile: \"12345678901\",\n        createTime: \"2018-08-08 00:08:00\",\n        updateTime: \"2018-08-08 00:08:00\"\n      }];\n      this.total = this.data.length;\n      this.loading = false;\n    },\n    handleSearch: function handleSearch() {\n      this.searchForm.pageNumber = 1;\n      this.searchForm.pageSize = 10;\n      this.getDataList();\n    },\n    handleReset: function handleReset() {\n      this.$refs.searchForm.resetFields();\n      this.searchForm.pageNumber = 1;\n      this.searchForm.pageSize = 10; // 重新加载数据\n\n      this.getDataList();\n    },\n    changeSort: function changeSort(e) {\n      this.searchForm.sort = e.key;\n      this.searchForm.order = e.order;\n\n      if (e.order === \"normal\") {\n        this.searchForm.order = \"\";\n      }\n\n      this.getDataList();\n    },\n    exportSelectData: function exportSelectData() {\n      if (this.selectCount <= 0) {\n        this.$Message.warning(\"您还未选择要导出的数据\");\n        return;\n      }\n\n      this.exportType = \"part\";\n      this.exportModalVisible = true;\n      this.exportTitle = \"确认导出 \" + this.selectCount + \" 条数据\";\n    },\n    exportAll: function exportAll() {\n      this.exportType = \"all\";\n      this.exportModalVisible = true;\n      this.exportTitle = \"确认导出全部 \" + this.total + \" 条数据\"; // 请求后端获取全部数据 请自行修改接口\n      // this.getRequest(\"请求路径\", params).then(res => {\n      //   if (res.success) {\n      //     this.exportData = res.result;\n      //   }\n      // });\n      // 以下为模拟数据\n\n      this.exportData = [{\n        id: \"1\",\n        name: \"X-BOOT\",\n        mobile: \"12345678901\",\n        createTime: \"2018-08-08 00:08:00\",\n        updateTime: \"2018-08-08 00:08:00\"\n      }, {\n        id: \"2\",\n        name: \"Exrick\",\n        mobile: \"12345678901\",\n        createTime: \"2018-08-08 00:08:00\",\n        updateTime: \"2018-08-08 00:08:00\"\n      }];\n    },\n    exportCustomData: function exportCustomData() {\n      var _this3 = this;\n\n      if (this.filename == \"\") {\n        this.filename = \"用户数据\";\n      } // 判断勾选导出列\n\n\n      var array = [];\n      this.exportColumns.forEach(function (e) {\n        _this3.chooseColumns.forEach(function (c) {\n          if (e.title === c && !e.disabled) {\n            array.push(e);\n          }\n        });\n      });\n      this.exportColumns = array;\n      this.exportModalVisible = false;\n      var title = [];\n      var key = [];\n      this.exportColumns.forEach(function (e) {\n        title.push(e.title);\n        key.push(e.key);\n      });\n      var params = {\n        title: title,\n        key: key,\n        data: this.exportData,\n        autoWidth: true,\n        filename: this.filename\n      };\n      excel.export_array_to_excel(params);\n    },\n    beforeUploadImport: function beforeUploadImport(file) {\n      this.uploadfile = file;\n      var fileExt = file.name.split(\".\").pop().toLocaleLowerCase();\n\n      if (fileExt === \"xlsx\" || fileExt === \"xls\") {\n        this.readFile(file);\n        this.file = file;\n      } else {\n        this.$Notice.warning({\n          title: \"文件类型错误\",\n          desc: \"所选文件‘ \" + file.name + \" ’不是EXCEL文件，请选择后缀为.xlsx或者.xls的EXCEL文件。\"\n        });\n      }\n\n      return false;\n    },\n    // 读取文件\n    readFile: function readFile(file) {\n      var _this4 = this;\n\n      var reader = new FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onerror = function (e) {\n        _this4.$Message.error(\"文件读取出错\");\n      };\n\n      reader.onload = function (e) {\n        _this4.$Message.success(\"读取数据成功\");\n\n        var data = e.target.result;\n\n        var _excel$read = excel.read(data, \"array\"),\n            header = _excel$read.header,\n            results = _excel$read.results;\n\n        var tableTitle = header.map(function (item) {\n          return {\n            title: item,\n            key: item\n          };\n        });\n        _this4.importTableData = results;\n        _this4.importColumns = tableTitle;\n      };\n    },\n    downloadTemple: function downloadTemple() {\n      var title = [];\n      var key = [];\n      userColumns.forEach(function (e) {\n        title.push(e.title);\n        key.push(e.key);\n      });\n      var params = {\n        title: title,\n        key: key,\n        data: userData,\n        autoWidth: true,\n        filename: \"导入数据模版\"\n      };\n      excel.export_array_to_excel(params);\n    },\n    importData: function importData() {\n      this.importLoading = true; // 传入导入数据 后端接收body数组列表批量导入\n      // this.importRequest(\"请求路径\", this.importTableData).then(res => {\n      //   this.importLoading = false;\n      //   if (res.success) {\n      //     this.importModalVisible = false;\n      //     this.getDataList();\n      //     this.$Modal.info({\n      //       title: \"导入结果\",\n      //       content: res.message\n      //     });\n      //   }\n      // });\n      // 模拟请求成功\n\n      this.importLoading = false;\n      this.importModalVisible = false;\n      this.$Modal.info({\n        title: \"导入结果\",\n        content: \"导入成功，这是假通知\"\n      });\n      this.getDataList();\n    },\n    showSelect: function showSelect(e) {\n      this.exportData = e;\n      this.selectList = e;\n      this.selectCount = e.length;\n    },\n    clearSelectAll: function clearSelectAll() {\n      this.$refs.table.selectAll(false);\n    }\n  },\n  mounted: function mounted() {\n    this.init();\n  }\n};",{"version":3,"sources":["excel.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkEA;AACA,SAAA,WAAA,EAAA,QAAA,QAAA,uBAAA,C,CACA;;AACA,OAAA,KAAA,MAAA,cAAA;AACA,eAAA;AACA,QAAA,OADA;AAEA,MAFA,kBAEA;AAAA;;AACA,WAAA;AACA,eAAA,IADA;AACA;AACA,qBAAA,KAFA;AAEA;AACA,qBAAA,IAHA;AAGA;AACA,0BAAA,KAJA;AAIA;AACA,0BAAA,KALA;AAKA;AACA,mBAAA,CANA;AAMA;AACA,kBAAA,EAPA;AAOA;AACA,kBAAA;AACA,oBAAA,CADA;AAEA,kBAAA,EAFA;AAGA,cAAA,YAHA;AAIA,eAAA;AAJA,OARA;AAcA,eAAA,CACA;AACA;AACA,cAAA,WADA;AAEA,eAAA,EAFA;AAGA,eAAA;AAHA,OAFA,EAOA;AACA,cAAA,OADA;AAEA,eAAA,EAFA;AAGA,eAAA;AAHA,OAPA,EAYA;AACA,eAAA,IADA;AAEA,aAAA,MAFA;AAGA,kBAAA;AAHA,OAZA,EAiBA;AACA,eAAA,IADA;AAEA,aAAA,QAFA;AAGA,kBAAA;AAHA,OAjBA,EAsBA;AACA,eAAA,MADA;AAEA,aAAA,YAFA;AAGA,kBAAA,IAHA;AAIA,kBAAA;AAJA,OAtBA,EA4BA;AACA,eAAA,MADA;AAEA,aAAA,YAFA;AAGA,kBAAA;AAHA,OA5BA,EAiCA;AACA,eAAA,IADA;AAEA,aAAA,QAFA;AAGA,eAAA,QAHA;AAIA,gBAAA,gBAAA,CAAA,EAAA,MAAA,EAAA;AACA,iBAAA,EAAA,KAAA,EAAA,CACA,EACA,QADA,EAEA;AACA,mBAAA;AACA,oBAAA,SADA;AAEA,oBAAA,OAFA;AAGA,oBAAA;AAHA,aADA;AAMA,mBAAA;AACA,2BAAA;AADA,aANA;AASA,gBAAA;AACA,qBAAA,iBAAA;AACA,sBAAA,QAAA,CAAA,IAAA,CAAA,OAAA;AACA;AAHA;AATA,WAFA,EAiBA,IAjBA,CADA,EAoBA,EACA,QADA,EAEA;AACA,mBAAA;AACA,oBAAA,OADA;AAEA,oBAAA,OAFA;AAGA,oBAAA;AAHA,aADA;AAMA,gBAAA;AACA,qBAAA,iBAAA;AACA,sBAAA,QAAA,CAAA,IAAA,CAAA,OAAA;AACA;AAHA;AANA,WAFA,EAcA,IAdA,CApBA,CAAA,CAAA;AAqCA;AA1CA,OAjCA,CAdA;AA4FA,qBAAA,CACA;AACA;AACA,eAAA,IADA;AAEA,aAAA,MAFA;AAGA,kBAAA;AAHA,OAFA,EAOA;AACA,eAAA,IADA;AAEA,aAAA,QAFA;AAGA,kBAAA;AAHA,OAPA,EAYA;AACA,eAAA,MADA;AAEA,aAAA,YAFA;AAGA,kBAAA,IAHA;AAIA,kBAAA;AAJA,OAZA,EAkBA;AACA,eAAA,MADA;AAEA,aAAA,YAFA;AAGA,kBAAA;AAHA,OAlBA,CA5FA;AAoHA,qBAAA,EApHA;AAqHA,gBAAA,IArHA;AAsHA,mBAAA,MAtHA;AAuHA,kBAAA,EAvHA;AAwHA,uBAAA,EAxHA;AAyHA,qBAAA,EAzHA;AA0HA,kBAAA;AACA,cAAA;AADA,OA1HA;AA6HA,mBAAA,WA7HA;AA8HA,gBAAA,QA9HA;AA+HA,YAAA,EA/HA;AAgIA,kBAAA,EAhIA;AAiIA,aAAA;AAjIA,KAAA;AAmIA,GAtIA;AAuIA,WAAA;AACA,QADA,kBACA;AAAA;;AACA,WAAA,WAAA,GADA,CAEA;;AACA,UAAA,QAAA,EAAA;AACA,WAAA,aAAA,CAAA,OAAA,CAAA,aAAA;AACA;AACA,YACA,CAAA,OAAA,QAAA,CAAA,OAAA,EAAA,QAAA,CAAA,YAAA,CAAA,IACA,EAAA,GAAA,KAAA,QAFA,EAGA;AACA,YAAA,KAAA,GAAA,YAAA,EAAA,KAAA;AACA,YAAA,QAAA,GAAA,IAAA;AACA,SANA,MAMA;AACA,YAAA,QAAA,GAAA,KAAA;AACA;;AACA,cAAA,IAAA,CAAA,EAAA,KAAA;AACA,OAZA;AAaA,WAAA,aAAA,GAAA,KAAA;AACA,KAnBA;AAoBA,cApBA,sBAoBA,CApBA,EAoBA;AACA,WAAA,UAAA,CAAA,UAAA,GAAA,CAAA;AACA,WAAA,WAAA;AACA,WAAA,cAAA;AACA,KAxBA;AAyBA,kBAzBA,0BAyBA,CAzBA,EAyBA;AACA,WAAA,UAAA,CAAA,QAAA,GAAA,CAAA;AACA,WAAA,WAAA;AACA,KA5BA;AA6BA,mBA7BA,2BA6BA,CA7BA,EA6BA;AACA,UAAA,CAAA,EAAA;AACA,aAAA,UAAA,CAAA,SAAA,GAAA,EAAA,CAAA,CAAA;AACA,aAAA,UAAA,CAAA,OAAA,GAAA,EAAA,CAAA,CAAA;AACA;AACA,KAlCA;AAmCA,eAnCA,yBAmCA;AACA,WAAA,OAAA,GAAA,IAAA;AACA,UAAA,SAAA;AACA,oBAAA,KAAA,UADA;AAEA,kBAAA,KAAA,QAFA;AAGA,cAAA,KAAA,UAHA;AAIA,eAAA,KAAA;AAJA,OAAA,CAFA,CAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,WAAA,IAAA,GAAA,CACA;AACA,YAAA,GADA;AAEA,cAAA,QAFA;AAGA,gBAAA,aAHA;AAIA,oBAAA,qBAJA;AAKA,oBAAA;AALA,OADA,EAQA;AACA,YAAA,GADA;AAEA,cAAA,QAFA;AAGA,gBAAA,aAHA;AAIA,oBAAA,qBAJA;AAKA,oBAAA;AALA,OARA,CAAA;AAgBA,WAAA,KAAA,GAAA,KAAA,IAAA,CAAA,MAAA;AACA,WAAA,OAAA,GAAA,KAAA;AACA,KAtEA;AAuEA,gBAvEA,0BAuEA;AACA,WAAA,UAAA,CAAA,UAAA,GAAA,CAAA;AACA,WAAA,UAAA,CAAA,QAAA,GAAA,EAAA;AACA,WAAA,WAAA;AACA,KA3EA;AA4EA,eA5EA,yBA4EA;AACA,WAAA,KAAA,CAAA,UAAA,CAAA,WAAA;AACA,WAAA,UAAA,CAAA,UAAA,GAAA,CAAA;AACA,WAAA,UAAA,CAAA,QAAA,GAAA,EAAA,CAHA,CAIA;;AACA,WAAA,WAAA;AACA,KAlFA;AAmFA,cAnFA,sBAmFA,CAnFA,EAmFA;AACA,WAAA,UAAA,CAAA,IAAA,GAAA,EAAA,GAAA;AACA,WAAA,UAAA,CAAA,KAAA,GAAA,EAAA,KAAA;;AACA,UAAA,EAAA,KAAA,KAAA,QAAA,EAAA;AACA,aAAA,UAAA,CAAA,KAAA,GAAA,EAAA;AACA;;AACA,WAAA,WAAA;AACA,KA1FA;AA2FA,oBA3FA,8BA2FA;AACA,UAAA,KAAA,WAAA,IAAA,CAAA,EAAA;AACA,aAAA,QAAA,CAAA,OAAA,CAAA,aAAA;AACA;AACA;;AACA,WAAA,UAAA,GAAA,MAAA;AACA,WAAA,kBAAA,GAAA,IAAA;AACA,WAAA,WAAA,GAAA,UAAA,KAAA,WAAA,GAAA,MAAA;AACA,KAnGA;AAoGA,aApGA,uBAoGA;AACA,WAAA,UAAA,GAAA,KAAA;AACA,WAAA,kBAAA,GAAA,IAAA;AACA,WAAA,WAAA,GAAA,YAAA,KAAA,KAAA,GAAA,MAAA,CAHA,CAIA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,WAAA,UAAA,GAAA,CACA;AACA,YAAA,GADA;AAEA,cAAA,QAFA;AAGA,gBAAA,aAHA;AAIA,oBAAA,qBAJA;AAKA,oBAAA;AALA,OADA,EAQA;AACA,YAAA,GADA;AAEA,cAAA,QAFA;AAGA,gBAAA,aAHA;AAIA,oBAAA,qBAJA;AAKA,oBAAA;AALA,OARA,CAAA;AAgBA,KA/HA;AAgIA,oBAhIA,8BAgIA;AAAA;;AACA,UAAA,KAAA,QAAA,IAAA,EAAA,EAAA;AACA,aAAA,QAAA,GAAA,MAAA;AACA,OAHA,CAIA;;;AACA,UAAA,QAAA,EAAA;AACA,WAAA,aAAA,CAAA,OAAA,CAAA,aAAA;AACA,eAAA,aAAA,CAAA,OAAA,CAAA,aAAA;AACA,cAAA,EAAA,KAAA,KAAA,CAAA,IAAA,CAAA,EAAA,QAAA,EAAA;AACA,kBAAA,IAAA,CAAA,CAAA;AACA;AACA,SAJA;AAKA,OANA;AAOA,WAAA,aAAA,GAAA,KAAA;AACA,WAAA,kBAAA,GAAA,KAAA;AACA,UAAA,QAAA,EAAA;AACA,UAAA,MAAA,EAAA;AACA,WAAA,aAAA,CAAA,OAAA,CAAA,aAAA;AACA,cAAA,IAAA,CAAA,EAAA,KAAA;AACA,YAAA,IAAA,CAAA,EAAA,GAAA;AACA,OAHA;AAIA,UAAA,SAAA;AACA,eAAA,KADA;AAEA,aAAA,GAFA;AAGA,cAAA,KAAA,UAHA;AAIA,mBAAA,IAJA;AAKA,kBAAA,KAAA;AALA,OAAA;AAOA,YAAA,qBAAA,CAAA,MAAA;AACA,KA7JA;AA8JA,sBA9JA,8BA8JA,IA9JA,EA8JA;AACA,WAAA,UAAA,GAAA,IAAA;AACA,UAAA,UAAA,KAAA,IAAA,CACA,KADA,CACA,GADA,EAEA,GAFA,GAGA,iBAHA,EAAA;;AAIA,UAAA,YAAA,MAAA,IAAA,YAAA,KAAA,EAAA;AACA,aAAA,QAAA,CAAA,IAAA;AACA,aAAA,IAAA,GAAA,IAAA;AACA,OAHA,MAGA;AACA,aAAA,OAAA,CAAA,OAAA,CAAA;AACA,iBAAA,QADA;AAEA,gBACA,WACA,KAAA,IADA,GAEA;AALA,SAAA;AAOA;;AACA,aAAA,KAAA;AACA,KAjLA;AAkLA;AACA,YAnLA,oBAmLA,IAnLA,EAmLA;AAAA;;AACA,UAAA,SAAA,IAAA,UAAA,EAAA;AACA,aAAA,iBAAA,CAAA,IAAA;;AACA,aAAA,OAAA,GAAA,aAAA;AACA,eAAA,QAAA,CAAA,KAAA,CAAA,QAAA;AACA,OAFA;;AAGA,aAAA,MAAA,GAAA,aAAA;AACA,eAAA,QAAA,CAAA,OAAA,CAAA,QAAA;;AACA,YAAA,OAAA,EAAA,MAAA,CAAA,MAAA;;AAFA,0BAGA,MAAA,IAAA,CAAA,IAAA,EAAA,OAAA,CAHA;AAAA,YAGA,MAHA,eAGA,MAHA;AAAA,YAGA,OAHA,eAGA,OAHA;;AAIA,YAAA,aAAA,OAAA,GAAA,CAAA,gBAAA;AACA,iBAAA;AAAA,mBAAA,IAAA;AAAA,iBAAA;AAAA,WAAA;AACA,SAFA,CAAA;AAGA,eAAA,eAAA,GAAA,OAAA;AACA,eAAA,aAAA,GAAA,UAAA;AACA,OATA;AAUA,KAnMA;AAoMA,kBApMA,4BAoMA;AACA,UAAA,QAAA,EAAA;AACA,UAAA,MAAA,EAAA;AACA,kBAAA,OAAA,CAAA,aAAA;AACA,cAAA,IAAA,CAAA,EAAA,KAAA;AACA,YAAA,IAAA,CAAA,EAAA,GAAA;AACA,OAHA;AAIA,UAAA,SAAA;AACA,eAAA,KADA;AAEA,aAAA,GAFA;AAGA,cAAA,QAHA;AAIA,mBAAA,IAJA;AAKA,kBAAA;AALA,OAAA;AAOA,YAAA,qBAAA,CAAA,MAAA;AACA,KAnNA;AAoNA,cApNA,wBAoNA;AACA,WAAA,aAAA,GAAA,IAAA,CADA,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,WAAA,aAAA,GAAA,KAAA;AACA,WAAA,kBAAA,GAAA,KAAA;AACA,WAAA,MAAA,CAAA,IAAA,CAAA;AACA,eAAA,MADA;AAEA,iBAAA;AAFA,OAAA;AAIA,WAAA,WAAA;AACA,KA1OA;AA2OA,cA3OA,sBA2OA,CA3OA,EA2OA;AACA,WAAA,UAAA,GAAA,CAAA;AACA,WAAA,UAAA,GAAA,CAAA;AACA,WAAA,WAAA,GAAA,EAAA,MAAA;AACA,KA/OA;AAgPA,kBAhPA,4BAgPA;AACA,WAAA,KAAA,CAAA,KAAA,CAAA,SAAA,CAAA,KAAA;AACA;AAlPA,GAvIA;AA2XA,SA3XA,qBA2XA;AACA,SAAA,IAAA;AACA;AA7XA,CAAA","sourcesContent":["<style lang=\"less\">\r\n@import \"./excel.less\";\r\n</style>\r\n<template>\r\n  <div class=\"search\">\r\n    <Row>\r\n      <Col>\r\n        <Card>\r\n          <Row class=\"operation\">\r\n            <Button @click=\"exportSelectData\" icon=\"md-cloud-upload\">导出所选数据</Button>\r\n            <Button @click=\"exportAll\" icon=\"ios-cloud-upload\">导出全部数据</Button>\r\n            <Button @click=\"importModalVisible=true\" icon=\"ios-download\">导入数据</Button>\r\n          </Row>\r\n          <Row>\r\n            <Alert show-icon>\r\n              已选择 <span class=\"select-count\">{{selectCount}}</span> 项\r\n              <a class=\"select-clear\" @click=\"clearSelectAll\">清空</a>\r\n            </Alert>\r\n          </Row>\r\n          <Row>\r\n            <Table :loading=\"loading\" border :columns=\"columns\" :data=\"data\" sortable=\"custom\" @on-sort-change=\"changeSort\" @on-selection-change=\"showSelect\" ref=\"table\"></Table>\r\n          </Row>\r\n          <Row type=\"flex\" justify=\"end\" class=\"page\">\r\n            <Page :current=\"searchForm.pageNumber\" :total=\"total\" :page-size=\"searchForm.pageSize\" @on-change=\"changePage\" @on-page-size-change=\"changePageSize\" :page-size-opts=\"[10,20,50]\" size=\"small\" show-total show-elevator show-sizer></Page>\r\n          </Row>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n    <!-- 自定义导出数据 -->\r\n    <Modal\r\n      v-model=\"exportModalVisible\"\r\n      :title=\"exportTitle\"\r\n      :loading=\"loadingExport\"\r\n      @on-ok=\"exportCustomData\">\r\n      <Form ref=\"exportForm\" :label-width=\"85\">\r\n        <FormItem label=\"导出文件名\">\r\n          <Input v-model=\"filename\"/>\r\n        </FormItem>\r\n        <FormItem label=\"自定义导出列\">\r\n          <CheckboxGroup v-model=\"chooseColumns\">\r\n            <Checkbox v-for=\"(item, i) in exportColumns\" :label=\"item.title\" :key=\"i\" :value=\"item.checked\" :disabled=\"item.disabled\"></Checkbox>\r\n          </CheckboxGroup>\r\n        </FormItem>\r\n      </Form>\r\n    </Modal>\r\n    <Drawer title=\"导入数据\" closable v-model=\"importModalVisible\" width=\"1000\">\r\n      <Upload action=\"\" :before-upload=\"beforeUploadImport\" accept=\".xls, .xlsx\">\r\n        <Button icon=\"ios-cloud-upload-outline\" style=\"margin-right:10px\">上传Excel文件</Button>\r\n        <span v-if=\"uploadfile.name!=''\">当前选择文件：{{ uploadfile.name }}</span>\r\n      </Upload>\r\n      <Alert type=\"warning\" show-icon>\r\n        导入前请下载查看导入模版数据文件，确保数据格式正确，不得修改列英文名称。\r\n      </Alert>\r\n      <Table :columns=\"importColumns\" border height=\"510\" :data=\"importTableData\" ref=\"importTable\"></Table>\r\n      <div class=\"drawer-footer\">\r\n        <Button @click=\"downloadTemple\" type=\"info\" style=\"position:absolute;left:15px;\">下载导入模板</Button>\r\n        <Button @click=\"importModalVisible=false\">关闭</Button>\r\n        <Button :loading=\"importLoading\" :disabled=\"importTableData.length<=0\" @click=\"importData\" style=\"margin-left:5px\" type=\"primary\">\r\n          确认导入<span v-if=\"importTableData.length>0\"> {{importTableData.length}} 条数据</span>\r\n        </Button>\r\n      </div>\r\n    </Drawer>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// 模版导入文件表数据\r\nimport { userColumns, userData } from \"@/libs/importTemplate\";\r\n// excel转换工具类\r\nimport excel from \"@/libs/excel\";\r\nexport default {\r\n  name: \"excel\",\r\n  data() {\r\n    return {\r\n      loading: true, // 表单加载状态\r\n      importLoading: false, // 导入加载状态\r\n      loadingExport: true, // 导出加载状态\r\n      exportModalVisible: false, // 自定义导出显示\r\n      importModalVisible: false, // 导入显示\r\n      selectCount: 0, // 多选计数\r\n      selectList: [], // 多选数据\r\n      searchForm: {\r\n        pageNumber: 1,\r\n        pageSize: 10,\r\n        sort: \"createTime\",\r\n        order: \"desc\"\r\n      },\r\n      columns: [\r\n        // 表头\r\n        {\r\n          type: \"selection\",\r\n          width: 60,\r\n          align: \"center\"\r\n        },\r\n        {\r\n          type: \"index\",\r\n          width: 60,\r\n          align: \"center\"\r\n        },\r\n        {\r\n          title: \"名称\",\r\n          key: \"name\",\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"手机\",\r\n          key: \"mobile\",\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"创建时间\",\r\n          key: \"createTime\",\r\n          sortable: true,\r\n          sortType: \"desc\"\r\n        },\r\n        {\r\n          title: \"更新时间\",\r\n          key: \"updateTime\",\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"操作\",\r\n          key: \"action\",\r\n          align: \"center\",\r\n          render: (h, params) => {\r\n            return h(\"div\", [\r\n              h(\r\n                \"Button\",\r\n                {\r\n                  props: {\r\n                    type: \"primary\",\r\n                    size: \"small\",\r\n                    icon: \"ios-create-outline\"\r\n                  },\r\n                  style: {\r\n                    marginRight: \"5px\"\r\n                  },\r\n                  on: {\r\n                    click: () => {\r\n                      this.$Message.info(\"点击了编辑\");\r\n                    }\r\n                  }\r\n                },\r\n                \"编辑\"\r\n              ),\r\n              h(\r\n                \"Button\",\r\n                {\r\n                  props: {\r\n                    type: \"error\",\r\n                    size: \"small\",\r\n                    icon: \"md-trash\"\r\n                  },\r\n                  on: {\r\n                    click: () => {\r\n                      this.$Message.info(\"点击了删除\");\r\n                    }\r\n                  }\r\n                },\r\n                \"删除\"\r\n              )\r\n            ]);\r\n          }\r\n        }\r\n      ],\r\n      exportColumns: [\r\n        // 导出列\r\n        {\r\n          title: \"名称\",\r\n          key: \"name\",\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"手机\",\r\n          key: \"mobile\",\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"创建时间\",\r\n          key: \"createTime\",\r\n          sortable: true,\r\n          sortType: \"desc\"\r\n        },\r\n        {\r\n          title: \"更新时间\",\r\n          key: \"updateTime\",\r\n          sortable: true\r\n        }\r\n      ],\r\n      chooseColumns: [],\r\n      filename: \"数据\",\r\n      exportTitle: \"确认导出\",\r\n      exportType: \"\",\r\n      importTableData: [],\r\n      importColumns: [],\r\n      uploadfile: {\r\n        name: \"\"\r\n      },\r\n      tempColumns: userColumns,\r\n      tempData: userData,\r\n      data: [],\r\n      exportData: [],\r\n      total: 0\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.getDataList();\r\n      // 初始化导出列数据\r\n      let array = [];\r\n      this.exportColumns.forEach(e => {\r\n        // 指定列限制权限\r\n        if (\r\n          !this.getStore(\"roles\").includes(\"ROLE_ADMIN\") &&\r\n          e.key === \"mobile\"\r\n        ) {\r\n          e.title = \"[无权导出] \" + e.title;\r\n          e.disabled = true;\r\n        } else {\r\n          e.disabled = false;\r\n        }\r\n        array.push(e.title);\r\n      });\r\n      this.chooseColumns = array;\r\n    },\r\n    changePage(v) {\r\n      this.searchForm.pageNumber = v;\r\n      this.getDataList();\r\n      this.clearSelectAll();\r\n    },\r\n    changePageSize(v) {\r\n      this.searchForm.pageSize = v;\r\n      this.getDataList();\r\n    },\r\n    selectDateRange(v) {\r\n      if (v) {\r\n        this.searchForm.startDate = v[0];\r\n        this.searchForm.endDate = v[1];\r\n      }\r\n    },\r\n    getDataList() {\r\n      this.loading = true;\r\n      let params = {\r\n        pageNumber: this.pageNumber,\r\n        pageSize: this.pageSize,\r\n        sort: this.sortColumn,\r\n        order: this.sortType\r\n      };\r\n      // 请求后端获取表单数据 请自行修改接口\r\n      // this.getRequest(\"请求路径\", params).then(res => {\r\n      //   this.loading = false;\r\n      //   if (res.success === true) {\r\n      //     this.data = res.result.content;\r\n      //     this.total = res.result.totalElements;\r\n      //   }\r\n      // });\r\n      // 以下为模拟数据\r\n      this.data = [\r\n        {\r\n          id: \"1\",\r\n          name: \"X-BOOT\",\r\n          mobile: \"12345678901\",\r\n          createTime: \"2018-08-08 00:08:00\",\r\n          updateTime: \"2018-08-08 00:08:00\"\r\n        },\r\n        {\r\n          id: \"2\",\r\n          name: \"Exrick\",\r\n          mobile: \"12345678901\",\r\n          createTime: \"2018-08-08 00:08:00\",\r\n          updateTime: \"2018-08-08 00:08:00\"\r\n        }\r\n      ];\r\n      this.total = this.data.length;\r\n      this.loading = false;\r\n    },\r\n    handleSearch() {\r\n      this.searchForm.pageNumber = 1;\r\n      this.searchForm.pageSize = 10;\r\n      this.getDataList();\r\n    },\r\n    handleReset() {\r\n      this.$refs.searchForm.resetFields();\r\n      this.searchForm.pageNumber = 1;\r\n      this.searchForm.pageSize = 10;\r\n      // 重新加载数据\r\n      this.getDataList();\r\n    },\r\n    changeSort(e) {\r\n      this.searchForm.sort = e.key;\r\n      this.searchForm.order = e.order;\r\n      if (e.order === \"normal\") {\r\n        this.searchForm.order = \"\";\r\n      }\r\n      this.getDataList();\r\n    },\r\n    exportSelectData() {\r\n      if (this.selectCount <= 0) {\r\n        this.$Message.warning(\"您还未选择要导出的数据\");\r\n        return;\r\n      }\r\n      this.exportType = \"part\";\r\n      this.exportModalVisible = true;\r\n      this.exportTitle = \"确认导出 \" + this.selectCount + \" 条数据\";\r\n    },\r\n    exportAll() {\r\n      this.exportType = \"all\";\r\n      this.exportModalVisible = true;\r\n      this.exportTitle = \"确认导出全部 \" + this.total + \" 条数据\";\r\n      // 请求后端获取全部数据 请自行修改接口\r\n      // this.getRequest(\"请求路径\", params).then(res => {\r\n      //   if (res.success) {\r\n      //     this.exportData = res.result;\r\n      //   }\r\n      // });\r\n      // 以下为模拟数据\r\n      this.exportData = [\r\n        {\r\n          id: \"1\",\r\n          name: \"X-BOOT\",\r\n          mobile: \"12345678901\",\r\n          createTime: \"2018-08-08 00:08:00\",\r\n          updateTime: \"2018-08-08 00:08:00\"\r\n        },\r\n        {\r\n          id: \"2\",\r\n          name: \"Exrick\",\r\n          mobile: \"12345678901\",\r\n          createTime: \"2018-08-08 00:08:00\",\r\n          updateTime: \"2018-08-08 00:08:00\"\r\n        }\r\n      ];\r\n    },\r\n    exportCustomData() {\r\n      if (this.filename == \"\") {\r\n        this.filename = \"用户数据\";\r\n      }\r\n      // 判断勾选导出列\r\n      let array = [];\r\n      this.exportColumns.forEach(e => {\r\n        this.chooseColumns.forEach(c => {\r\n          if (e.title === c && !e.disabled) {\r\n            array.push(e);\r\n          }\r\n        });\r\n      });\r\n      this.exportColumns = array;\r\n      this.exportModalVisible = false;\r\n      let title = [];\r\n      let key = [];\r\n      this.exportColumns.forEach(e => {\r\n        title.push(e.title);\r\n        key.push(e.key);\r\n      });\r\n      const params = {\r\n        title: title,\r\n        key: key,\r\n        data: this.exportData,\r\n        autoWidth: true,\r\n        filename: this.filename\r\n      };\r\n      excel.export_array_to_excel(params);\r\n    },\r\n    beforeUploadImport(file) {\r\n      this.uploadfile = file;\r\n      const fileExt = file.name\r\n        .split(\".\")\r\n        .pop()\r\n        .toLocaleLowerCase();\r\n      if (fileExt === \"xlsx\" || fileExt === \"xls\") {\r\n        this.readFile(file);\r\n        this.file = file;\r\n      } else {\r\n        this.$Notice.warning({\r\n          title: \"文件类型错误\",\r\n          desc:\r\n            \"所选文件‘ \" +\r\n            file.name +\r\n            \" ’不是EXCEL文件，请选择后缀为.xlsx或者.xls的EXCEL文件。\"\r\n        });\r\n      }\r\n      return false;\r\n    },\r\n    // 读取文件\r\n    readFile(file) {\r\n      const reader = new FileReader();\r\n      reader.readAsArrayBuffer(file);\r\n      reader.onerror = e => {\r\n        this.$Message.error(\"文件读取出错\");\r\n      };\r\n      reader.onload = e => {\r\n        this.$Message.success(\"读取数据成功\");\r\n        const data = e.target.result;\r\n        const { header, results } = excel.read(data, \"array\");\r\n        const tableTitle = header.map(item => {\r\n          return { title: item, key: item };\r\n        });\r\n        this.importTableData = results;\r\n        this.importColumns = tableTitle;\r\n      };\r\n    },\r\n    downloadTemple() {\r\n      let title = [];\r\n      let key = [];\r\n      userColumns.forEach(e => {\r\n        title.push(e.title);\r\n        key.push(e.key);\r\n      });\r\n      const params = {\r\n        title: title,\r\n        key: key,\r\n        data: userData,\r\n        autoWidth: true,\r\n        filename: \"导入数据模版\"\r\n      };\r\n      excel.export_array_to_excel(params);\r\n    },\r\n    importData() {\r\n      this.importLoading = true;\r\n      // 传入导入数据 后端接收body数组列表批量导入\r\n      // this.importRequest(\"请求路径\", this.importTableData).then(res => {\r\n      //   this.importLoading = false;\r\n      //   if (res.success) {\r\n      //     this.importModalVisible = false;\r\n      //     this.getDataList();\r\n      //     this.$Modal.info({\r\n      //       title: \"导入结果\",\r\n      //       content: res.message\r\n      //     });\r\n      //   }\r\n      // });\r\n      // 模拟请求成功\r\n      this.importLoading = false;\r\n      this.importModalVisible = false;\r\n      this.$Modal.info({\r\n        title: \"导入结果\",\r\n        content: \"导入成功，这是假通知\"\r\n      });\r\n      this.getDataList();\r\n    },\r\n    showSelect(e) {\r\n      this.exportData = e;\r\n      this.selectList = e;\r\n      this.selectCount = e.length;\r\n    },\r\n    clearSelectAll() {\r\n      this.$refs.table.selectAll(false);\r\n    }\r\n  },\r\n  mounted() {\r\n    this.init();\r\n  }\r\n};\r\n</script>"],"sourceRoot":"src\\views\\xboot-vue-template\\excel"}]}
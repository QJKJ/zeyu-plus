{"remainingRequest":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\zeyu\\zeyu-plus\\xboot-plus-front\\src\\views\\sys\\setting-manage\\settingManage.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\src\\views\\sys\\setting-manage\\settingManage.vue","mtime":1547113832726},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\postcss-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":1545803960479},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1545803981415},{"path":"D:\\zeyu\\zeyu-plus\\xboot-plus-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\n@import \"./settingManage.less\";\r\n",{"version":3,"sources":["settingManage.vue"],"names":[],"mappings":";AACA","file":"settingManage.vue","sourceRoot":"src\\views\\sys\\setting-manage","sourcesContent":["<style lang=\"less\">\r\n@import \"./settingManage.less\";\r\n</style>\r\n<template>\r\n  <div class=\"tabMain\">\r\n    <Card>\r\n      <Tabs v-model=\"tabName\" :animated=\"false\" style=\"overflow: visible\">\r\n\r\n\r\n        <TabPane label=\"核心配置\" name=\"core\">\r\n          <div style=\"position:relative\">\r\n            <Form\r\n                    ref=\"coreForm\"\r\n                    :model=\"core\"\r\n                    :label-width=\"110\"\r\n                    label-position=\"right\"\r\n                    :rules=\"coreValidate\"\r\n            >\r\n              <FormItem label=\"平台名称：\" prop=\"platformName\">\r\n                <Tooltip placement=\"right\" max-width=\"200\" content=\"浏览器页签名称使用\">\r\n                  <Input type=\"text\" v-model=\"core.platformName\" placeholder=\"请输入平台名称，如 Zeyu 快速开发平台\" style=\"width: 350px\"/>\r\n                </Tooltip>\r\n              </FormItem>\r\n              <FormItem label=\"平台描述信息：\" prop=\"platformInfo\">\r\n                <Tooltip placement=\"right\" max-width=\"200\" content=\"登录页平台描述信息使用\">\r\n                  <Input type=\"text\" v-model=\"core.platformInfo\" placeholder=\"请输入描述信息，如 Zeyu 是一个基于Vue前后分离分布式后台架构搭建的系统\" style=\"width: 350px\"/>\r\n                </Tooltip>\r\n              </FormItem>\r\n\r\n              <FormItem label=\"版权\" prop=\"copyright\">\r\n                <div ref=\"editor\"></div>\r\n              </FormItem>\r\n\r\n              <Form-item label class=\"br\">\r\n                <Button @click=\"editHTML\" icon=\"ios-create-outline\">编辑HTML代码</Button>\r\n                <Button @click=\"fullscreenModal=true\" icon=\"md-eye\">全屏预览</Button>\r\n              </Form-item>\r\n\r\n              <FormItem label=\"登录百叶窗效果\" prop=\"isShowShades\">\r\n                <i-switch size=\"large\" v-model=\"core.isShowShades\" :true-value=\"'0'\" :false-value=\"'-1'\">\r\n                  <span slot=\"open\">启用</span>\r\n                  <span slot=\"close\">禁用</span>\r\n                </i-switch>\r\n              </FormItem>\r\n\r\n              <!--platformName //平台名称\r\n              platformInfo //平台描述信息\r\n              copyright  //版权\r\n              isShowShades //登录百叶窗效果\r\n              homeLogo//平台首页Logo\r\n              shrinkLogo//菜单收缩首页Logo\r\n              loginLogo//登录Logo\r\n              iconIco//icon图标-->\r\n\r\n              <Form-item label=\"平台首页Logo\" prop=\"homeLogo\" >\r\n                <Poptip trigger=\"hover\" title=\"图片预览\" placement=\"top-start\" width=\"350\">\r\n                  <Input  v-model=\"core.homeLogo\" placeholder=\"可直接填入网络图片链接\" clearable/>\r\n                  <div slot=\"content\">\r\n                    <img :src=\"core.homeLogo\" alt=\"无效的图片链接\" style=\"width: 100%;margin: 0 auto;display: block;\">\r\n                    <a @click=\"homeLogoViewPic()\" style=\"margin-top:5px;text-align:right;display:block\">查看原图</a>\r\n                  </div>\r\n                </Poptip>\r\n                <Upload :action=\"uploadFileUrl\"\r\n                        :headers=\"accessToken\"\r\n                        :on-success=\"homeLogoHandleSuccess\"\r\n                        :on-error=\"handleError\"\r\n                        :format=\"['jpg','jpeg','png','gif']\"\r\n                        :max-size=\"5120\"\r\n                        :on-format-error=\"handleFormatError\"\r\n                        :on-exceeded-size=\"handleMaxSize\"\r\n                        :before-upload=\"beforeUpload\"\r\n                        ref=\"up\"\r\n                        class=\"upload\">\r\n                  <Button icon=\"ios-cloud-upload-outline\">上传图片</Button>\r\n                </Upload>\r\n              </Form-item>\r\n\r\n\r\n              <Form-item label=\"菜单收缩首页Logo\" prop=\"shrinkLogo\">\r\n                <Poptip trigger=\"hover\" title=\"图片预览\" placement=\"top-start\" width=\"350\">\r\n                  <Input v-model=\"core.shrinkLogo\" placeholder=\"可直接填入网络图片链接\" clearable/>\r\n                  <div slot=\"content\">\r\n                    <img :src=\"core.shrinkLogo\" alt=\"无效的图片链接\" style=\"width: 100%;margin: 0 auto;display: block;\">\r\n                    <a @click=\"shrinkLogoViewPic()\" style=\"margin-top:5px;text-align:right;display:block\">查看原图</a>\r\n                  </div>\r\n                </Poptip>\r\n                <Upload :action=\"uploadFileUrl\"\r\n                        :headers=\"accessToken\"\r\n                        :on-success=\"shrinkLogoHandleSuccess\"\r\n                        :on-error=\"handleError\"\r\n                        :format=\"['jpg','jpeg','png','gif']\"\r\n                        :max-size=\"5120\"\r\n                        :on-format-error=\"handleFormatError\"\r\n                        :on-exceeded-size=\"handleMaxSize\"\r\n                        :before-upload=\"beforeUpload\"\r\n                        ref=\"up\"\r\n                        class=\"upload\">\r\n                  <Button icon=\"ios-cloud-upload-outline\">上传图片</Button>\r\n                </Upload>\r\n              </Form-item>\r\n\r\n\r\n              <Form-item label=\"登录Logo\" prop=\"loginLogo\">\r\n                <Poptip trigger=\"hover\" title=\"图片预览\" placement=\"top-start\" width=\"350\">\r\n                  <Input v-model=\"core.loginLogo\" placeholder=\"可直接填入网络图片链接\" clearable/>\r\n                  <div slot=\"content\">\r\n                    <img :src=\"core.loginLogo\" alt=\"无效的图片链接\" style=\"width: 100%;margin: 0 auto;display: block;\">\r\n                    <a @click=\"loginLogoViewPic()\" style=\"margin-top:5px;text-align:right;display:block\">查看原图</a>\r\n                  </div>\r\n                </Poptip>\r\n                <Upload :action=\"uploadFileUrl\"\r\n                        :headers=\"accessToken\"\r\n                        :on-success=\"loginLogoHandleSuccess\"\r\n                        :on-error=\"handleError\"\r\n                        :format=\"['jpg','jpeg','png','gif']\"\r\n                        :max-size=\"5120\"\r\n                        :on-format-error=\"handleFormatError\"\r\n                        :on-exceeded-size=\"handleMaxSize\"\r\n                        :before-upload=\"beforeUpload\"\r\n                        ref=\"up\"\r\n                        class=\"upload\">\r\n                  <Button icon=\"ios-cloud-upload-outline\">上传图片</Button>\r\n                </Upload>\r\n              </Form-item>\r\n\r\n\r\n              <Form-item label=\"icon图标\" prop=\"iconIco\">\r\n                <Poptip trigger=\"hover\" title=\"图片预览\" placement=\"top-start\" width=\"350\">\r\n                  <Input v-model=\"core.iconIco\" placeholder=\"可直接填入网络图片链接\" clearable/>\r\n                  <div slot=\"content\">\r\n                    <img :src=\"core.iconIco\" alt=\"无效的图片链接\" style=\"width: 100%;margin: 0 auto;display: block;\">\r\n                    <a @click=\"iconIcoViewPic()\" style=\"margin-top:5px;text-align:right;display:block\">查看原图</a>\r\n                  </div>\r\n                </Poptip>\r\n                <Upload :action=\"uploadFileUrl\"\r\n                        :headers=\"accessToken\"\r\n                        :on-success=\"iconIcoHandleSuccess\"\r\n                        :on-error=\"handleError\"\r\n                        :format=\"['jpg','jpeg','png','gif']\"\r\n                        :max-size=\"5120\"\r\n                        :on-format-error=\"handleFormatError\"\r\n                        :on-exceeded-size=\"handleMaxSize\"\r\n                        :before-upload=\"beforeUpload\"\r\n                        ref=\"up\"\r\n                        class=\"upload\">\r\n                  <Button icon=\"ios-cloud-upload-outline\">上传图片</Button>\r\n                </Upload>\r\n              </Form-item>\r\n\r\n\r\n              <FormItem>\r\n                <Button type=\"primary\" style=\"width: 100px;margin-right:5px\" :loading=\"saveLoading\" @click=\"saveEditCore\">保存更改</Button>\r\n              </FormItem>\r\n            </Form>\r\n            <Spin fix v-if=\"loading\"></Spin>\r\n          </div>\r\n        </TabPane>\r\n\r\n\r\n        <TabPane label=\"登录幻灯片图片\" name=\"shades\">\r\n          <div style=\"position:relative\">\r\n            <shadesManage/>\r\n            <Spin fix v-if=\"loading\"></Spin>\r\n          </div>\r\n        </TabPane>\r\n\r\n\r\n\r\n        <TabPane label=\"文件对象存储配置\" name=\"oss\">\r\n          <div style=\"position:relative\">\r\n          <Form \r\n            ref=\"ossForm\"\r\n            :model=\"oss\" \r\n            :label-width=\"110\" \r\n            label-position=\"right\"\r\n            :rules=\"ossValidate\"\r\n            >\r\n            <FormItem label=\"服务提供商：\" prop=\"serviceName\">\r\n              <Select v-model=\"oss.serviceName\" @on-change=\"changeOss\" placeholder=\"请选择\" style=\"width: 200px\">\r\n                <Option value=\"LOCAL_OSS\">本地服务器</Option>\r\n                <Option value=\"QINIU_OSS\">七牛云</Option>\r\n                <Option value=\"ALI_OSS\">阿里云</Option>\r\n                <Option value=\"TENCENT_OSS\">腾讯云</Option>\r\n              </Select>\r\n            </FormItem>\r\n            <div v-if=\"oss.serviceName!='LOCAL_OSS'\">\r\n              <FormItem label=\"accessKey：\" prop=\"accessKey\">\r\n                <Input type=\"text\" v-model=\"oss.accessKey\" placeholder=\"请输入accessKey\" style=\"width: 350px\"/>\r\n              </FormItem>\r\n              <FormItem label=\"secretKey：\" prop=\"secretKey\">\r\n                <Tooltip placement=\"right\" content=\"无法编辑时请先点击查看图标\">\r\n                  <Input class=\"input-see\" type=\"text\" v-model=\"oss.secretKey\" :readonly=\"!changedOssSK\" @on-click=\"seeSecret(oss.serviceName)\" icon=\"ios-eye\" placeholder=\"请输入secretKey\" style=\"width: 350px\"/>\r\n                </Tooltip>\r\n              </FormItem>\r\n              <FormItem v-if=\"oss.serviceName=='QINIU_OSS'\" label=\"zone存储区域：\" prop=\"zone\">\r\n                <Select v-model=\"oss.zone\" placeholder=\"请选择存储区域\" style=\"width: 350px\">\r\n                  <Option :value=\"-1\">自动判断</Option>\r\n                  <Option :value=\"0\">华东</Option>\r\n                  <Option :value=\"1\">华北</Option>\r\n                  <Option :value=\"2\">华南</Option>\r\n                  <Option :value=\"3\">北美</Option>\r\n                  <Option :value=\"4\">东南亚</Option>\r\n                </Select>\r\n              </FormItem>\r\n              <FormItem label=\"bucket空间：\" prop=\"bucket\">\r\n                <Input type=\"text\" v-model=\"oss.bucket\" placeholder=\"请输入bucket空间名\" style=\"width: 350px\"/>\r\n              </FormItem>\r\n              <FormItem v-if=\"oss.serviceName=='TENCENT_OSS'\" label=\"所属地域：\" prop=\"bucketRegion\">\r\n                <Select v-model=\"oss.bucketRegion\" placeholder=\"请选择或输入搜索\" style=\"width: 350px\" filterable>\r\n                  <Option v-for=\"(item, i) in dictBucketRegions\" :key=\"i\" :value=\"item.value\">{{item.title}}</Option>\r\n                </Select>\r\n              </FormItem>\r\n              <FormItem label=\"endpoint域名：\" prop=\"endpoint\" :error=\"errorMsg\">\r\n                <Input type=\"text\" v-model=\"oss.endpoint\" :placeholder=\"endpointPH\" style=\"width: 350px\">\r\n                  <Select v-model=\"oss.http\" slot=\"prepend\" style=\"width: 80px\" prop=\"http\">\r\n                    <Option value=\"http://\">http://</Option>\r\n                    <Option value=\"https://\">https://</Option>\r\n                  </Select>\r\n                </Input>\r\n              </FormItem>\r\n            </div>\r\n            <div v-else>\r\n              <FormItem label=\"存储磁盘路径：\" prop=\"filePath\" :error=\"errorMsg2\">\r\n                <Input type=\"text\" v-model=\"oss.filePath\" placeholder=\"例如：D:/upload\" style=\"width: 350px\"/>\r\n              </FormItem>\r\n              <FormItem label=\"文件预览接口：\" prop=\"endpoint\" :error=\"errorMsg\">\r\n                <Input type=\"text\" v-model=\"oss.endpoint\" placeholder=\"请输入文件预览接口\" style=\"width: 350px\">\r\n                  <Select v-model=\"oss.http\" slot=\"prepend\" style=\"width: 80px\" prop=\"http\">\r\n                    <Option value=\"http://\">http://</Option>\r\n                    <Option value=\"https://\">https://</Option>\r\n                  </Select>\r\n                </Input>\r\n              </FormItem>\r\n            </div>\r\n            <FormItem>\r\n              <Button type=\"primary\" style=\"width: 100px;margin-right:5px\" :loading=\"saveLoading\" @click=\"saveEditOss\">保存并启用</Button>\r\n            </FormItem>\r\n           </Form>\r\n           <Spin fix v-if=\"loading\"></Spin>\r\n          </div>\r\n        </TabPane>\r\n        <TabPane label=\"短信配置\" name=\"sms\">\r\n          <div style=\"position:relative\">\r\n            <Form \r\n              ref=\"smsForm\"\r\n              :model=\"sms\" \r\n              :label-width=\"110\" \r\n              label-position=\"right\"\r\n              :rules=\"smsValidate\"\r\n              > \r\n              <FormItem label=\"服务提供商：\" prop=\"serviceName\">\r\n                <Select v-model=\"sms.serviceName\" placeholder=\"请选择\" style=\"width: 200px\">\r\n                  <Option value=\"ALI_SMS\">阿里云</Option>\r\n                </Select>\r\n              </FormItem>\r\n              <FormItem label=\"accessKey：\" prop=\"accessKey\">\r\n                <Input type=\"text\" v-model=\"sms.accessKey\" placeholder=\"请输入\" style=\"width: 350px\"/>\r\n              </FormItem>\r\n              <FormItem label=\"secretKey：\" prop=\"secretKey\">\r\n                <Tooltip placement=\"right\" content=\"无法编辑时请先点击查看图标\">\r\n                    <Input class=\"input-see\" type=\"text\" v-model=\"sms.secretKey\" :readonly=\"!changedSmsSK\" @on-click=\"seeSecret(sms.serviceName)\" icon=\"ios-eye\" placeholder=\"请输入\" style=\"width: 350px\"/>\r\n                </Tooltip>\r\n              </FormItem>\r\n              <FormItem label=\"短信签名：\" prop=\"signName\">\r\n                <Input type=\"text\" v-model=\"sms.signName\" placeholder=\"请输入短信签名，例如XBoot\" style=\"width: 350px\"/>\r\n              </FormItem>\r\n              <FormItem label=\"使用场景：\" prop=\"type\">\r\n                <Select v-model=\"sms.type\" @on-change=\"changeSmsType\" placeholder=\"请选择\" style=\"width: 350px\">\r\n                  <Option value=\"-1\">通用</Option>\r\n                  <Option value=\"0\">注册</Option>\r\n                  <Option value=\"1\">登录</Option>\r\n                  <Option value=\"2\">修改绑定手机号</Option>\r\n                  <Option value=\"3\">修改密码</Option>\r\n                  <Option value=\"4\">重置密码</Option>\r\n                </Select>\r\n              </FormItem>\r\n              <FormItem label=\"模版CODE：\" prop=\"templateCode\">\r\n                <Input type=\"text\" v-model=\"sms.templateCode\" placeholder=\"请输入场景对应短信模版CODE，例如SMS_123456789\" style=\"width: 350px\"/>\r\n              </FormItem>\r\n              <FormItem>\r\n                <Button type=\"primary\" style=\"width: 100px;margin-right:5px\" :loading=\"saveLoading\" @click=\"saveEditSms\">保存更改</Button>\r\n              </FormItem>\r\n            </Form>\r\n            <Spin fix v-if=\"loading\"></Spin>\r\n          </div>\r\n        </TabPane>\r\n        <TabPane label=\"邮件配置\" name=\"email\">\r\n          <div style=\"position:relative\">\r\n            <Form \r\n              ref=\"emailForm\"\r\n              :model=\"email\" \r\n              :label-width=\"110\" \r\n              label-position=\"right\"\r\n              :rules=\"emailValidate\"\r\n              > \r\n              <FormItem label=\"邮箱服务器：\" prop=\"host\">\r\n                <Input type=\"text\" v-model=\"email.host\" placeholder=\"请输入邮箱服务器Host，例如QQ邮箱为smtp.qq.com\" style=\"width: 350px\"/>\r\n              </FormItem>\r\n              <FormItem label=\"发送邮箱账号：\" prop=\"username\">\r\n                <Input type=\"text\" v-model=\"email.username\" placeholder=\"请输入发送者Email账号\" style=\"width: 350px\"/>\r\n              </FormItem>\r\n              <FormItem label=\"邮箱授权码：\" prop=\"password\">\r\n                <Tooltip placement=\"right\" content=\"无法编辑时请先点击查看图标\">\r\n                    <Input class=\"input-see\" type=\"text\" v-model=\"email.password\" :readonly=\"!changedEmailPass\" @on-click=\"seeSecret('EMAIL_SETTING')\" icon=\"ios-eye\" placeholder=\"请输入邮箱授权码，进入邮箱-设置中可找到\" style=\"width: 350px\"/>\r\n                </Tooltip>\r\n              </FormItem>\r\n              <FormItem>\r\n                <Button type=\"primary\" style=\"width: 100px;margin-right:5px\" :loading=\"saveLoading\" @click=\"saveEditEmail\">保存更改</Button>\r\n              </FormItem>\r\n            </Form>\r\n            </Form>\r\n            <Spin fix v-if=\"loading\"></Spin>\r\n          </div>\r\n        </TabPane>\r\n        <TabPane label=\"Vaptcha验证码\" name=\"vaptcha\">\r\n          <div style=\"position:relative\">\r\n            <Form \r\n              ref=\"vaptchaForm\"\r\n              :model=\"vaptcha\" \r\n              :label-width=\"110\" \r\n              label-position=\"right\"\r\n              :rules=\"vaptchaValidate\"\r\n              > \r\n              <FormItem label=\"VID：\" prop=\"vid\">\r\n                <Input type=\"text\" v-model=\"vaptcha.vid\" placeholder=\"请输入验证单元VID\" style=\"width: 350px\"/>\r\n              </FormItem>\r\n              <FormItem label=\"secretKey：\" prop=\"secretKey\">\r\n                <Tooltip placement=\"right\" content=\"无法编辑时请先点击查看图标\">\r\n                    <Input class=\"input-see\" type=\"text\" v-model=\"vaptcha.secretKey\" :readonly=\"!changedVaptchaSK\" @on-click=\"seeSecret('VAPTCHA_SETTING')\" icon=\"ios-eye\" placeholder=\"请输入验证单元Key\" style=\"width: 350px\"/>\r\n                </Tooltip>\r\n              </FormItem>\r\n              <FormItem>\r\n                <Button type=\"primary\" style=\"width: 100px;margin-right:5px\" :loading=\"saveLoading\" @click=\"saveEditVaptcha\">保存更改</Button>\r\n              </FormItem>\r\n            </Form>\r\n            <Spin fix v-if=\"loading\"></Spin>\r\n          </div>\r\n        </TabPane>\r\n\r\n\r\n\r\n\r\n        <TabPane label=\"其他配置\" name=\"other\">\r\n          <div style=\"position:relative\">\r\n            <Form \r\n              ref=\"otherForm\"\r\n              :model=\"other\" \r\n              :label-width=\"110\" \r\n              label-position=\"right\"\r\n              :rules=\"otherValidate\"\r\n              > \r\n              <FormItem label=\"应用部署域名：\" prop=\"domain\">\r\n                <Tooltip placement=\"right\" max-width=\"200\" content=\"拼接部分资源访问链接使用\">\r\n                  <Input type=\"text\" v-model=\"other.domain\" placeholder=\"请输入应用部署域名前缀，如http://xboot.exrick.cn\" style=\"width: 350px\"/>\r\n                </Tooltip>\r\n              </FormItem>\r\n              <FormItem label=\"IP黑名单：\" prop=\"blacklist\">\r\n                <Input type=\"textarea\" v-model=\"other.blacklist\" :rows=\"4\" placeholder=\"多个以回车分隔\" style=\"width: 350px\"/>\r\n              </FormItem>\r\n              <FormItem>\r\n                <Button type=\"primary\" style=\"width: 100px;margin-right:5px\" :loading=\"saveLoading\" @click=\"saveEditOther\">保存更改</Button>\r\n              </FormItem>\r\n            </Form>\r\n            <Spin fix v-if=\"loading\"></Spin>\r\n          </div>\r\n        </TabPane>\r\n\r\n\r\n\r\n\r\n\r\n      </Tabs>   \r\n    </Card>\r\n\r\n    <!-- html编辑 -->\r\n    <Modal\r\n      title=\"编辑html代码\"\r\n      v-model=\"showHTMLModal\"\r\n      :mask-closable=\"false\"\r\n      :width=\"900\"\r\n      :fullscreen=\"full\"\r\n    >\r\n      <Input\r\n        v-if=\"!full\"\r\n        v-model=\"dataEdit\"\r\n        :autosize=\"true\"\r\n        type=\"textarea\"\r\n        style=\"max-height:60vh;overflow:auto\"\r\n      />\r\n      <Input v-if=\"full\" v-model=\"dataEdit\" :autosize=\"true\" type=\"textarea\"/>\r\n      <div slot=\"footer\">\r\n        <Button @click=\"full=!full\" icon=\"md-expand\">全屏开/关</Button>\r\n        <Button @click=\"editHTMLOk\" type=\"primary\" icon=\"md-checkmark-circle-outline\">确定保存</Button>\r\n      </div>\r\n    </Modal>\r\n    <Modal title=\"预览\" v-model=\"fullscreenModal\" fullscreen>\r\n      <div v-html=\"core.copyright\">{{core.copyright}}</div>\r\n      <div slot=\"footer\">\r\n        <Button @click=\"fullscreenModal=false\">关闭</Button>\r\n      </div>\r\n    </Modal>\r\n\r\n    <!--  核心配置图片预览弹出框 -->\r\n    <Modal title=\"图片预览\" v-model=\"homeLogoViewImage\" :styles=\"{top: '30px'}\" draggable>\r\n      <img :src=\"core.homeLogo\" alt=\"无效的图片链接\" style=\"width: 100%;margin: 0 auto;display: block;\">\r\n      <div slot=\"footer\">\r\n        <Button @click=\"homeLogoViewImage=false\">关闭</Button>\r\n      </div>\r\n    </Modal>\r\n    <Modal title=\"图片预览\" v-model=\"shrinkLogoViewImage\" :styles=\"{top: '30px'}\" draggable>\r\n      <img :src=\"core.shrinkLogo\" alt=\"无效的图片链接\" style=\"width: 100%;margin: 0 auto;display: block;\">\r\n      <div slot=\"footer\">\r\n        <Button @click=\"shrinkLogoViewImage=false\">关闭</Button>\r\n      </div>\r\n    </Modal>\r\n    <Modal title=\"图片预览\" v-model=\"loginLogoViewImage\" :styles=\"{top: '30px'}\" draggable>\r\n      <img :src=\"core.loginLogo\" alt=\"无效的图片链接\" style=\"width: 100%;margin: 0 auto;display: block;\">\r\n      <div slot=\"footer\">\r\n        <Button @click=\"loginLogoViewImage=false\">关闭</Button>\r\n      </div>\r\n    </Modal>\r\n    <Modal title=\"图片预览\" v-model=\"iconIcoViewImage\" :styles=\"{top: '30px'}\" draggable>\r\n      <img :src=\"core.iconIco\" alt=\"无效的图片链接\" style=\"width: 100%;margin: 0 auto;display: block;\">\r\n      <div slot=\"footer\">\r\n        <Button @click=\"iconIcoViewImage=false\">关闭</Button>\r\n      </div>\r\n    </Modal>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  seeSecretSet,\r\n  checkOssSet,\r\n  getOssSet,\r\n  editOssSet,\r\n  getSmsSet,\r\n  editSmsSet,\r\n  getSmsTemplateCode,\r\n  getEmailSet,\r\n  editEmailSet,\r\n  getVaptchaSet,\r\n  editVaptchaSet,\r\n  getOtherSet,\r\n  editOtherSet,\r\n  editCoreSet,\r\n  getCoreSet,\r\n  getDictDataByType,\r\n  uploadFile\r\n} from \"@/api/index\";\r\n// 表情包配置 自定义表情可在该js文件中统一修改\r\nimport { sina } from \"@/libs/emoji\";\r\n\r\n\r\nimport shadesManage from \"../shadesManage/shadesManage.vue\";\r\n\r\nimport E from \"wangeditor\";\r\nlet editor = null;\r\nvar xss = require(\"xss\");\r\nexport default {\r\n  name: \"setting-manage\",\r\n  components: {\r\n    shadesManage\r\n  },\r\n  data() {\r\n    return {\r\n      tabName: \"core\",\r\n      loading: false, // 表单加载状态\r\n      saveLoading: false,\r\n      oss: {\r\n        serviceName: \"\"\r\n      },\r\n      accessToken: {},\r\n      changedOssSK: false, // 是否修改oss的secrectKey\r\n      sms: {\r\n        serviceName: \"ALI_SMS\"\r\n      },\r\n      core: {\r\n            platformName: \"\",\r\n            platformInfo: \"\",\r\n            isShowShades: \"\",\r\n            homeLogo:\"\",\r\n            shrinkLogo: \"\",\r\n            loginLogo: \"\",\r\n            iconIco: \"\",\r\n            copyright:\"\"\r\n      },\r\n      uploadfile: {\r\n        name: \"\"\r\n      },\r\n      uploadFileUrl: uploadFile,\r\n      changedSmsSK: false, // 是否修改短信的secrectKey\r\n      email: {},\r\n      changedEmailPass: false, // 是否修改邮件密码\r\n      errorMsg: \"\",\r\n      errorMsg2: \"\",\r\n      vaptcha: {},\r\n      changedVaptchaSK: false, // 是否修改Vaptcha的secrectKey\r\n      other: {\r\n        blacklist: \"\"\r\n      },\r\n      ossValidate: {\r\n        // 表单验证规则\r\n        serviceName: [{ required: true, message: \"请选择\", trigger: \"blur\" }],\r\n        accessKey: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        secretKey: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        endpoint: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        bucket: [{ required: true, message: \"不能为空\", trigger: \"blur\" }]\r\n      },\r\n      homeLogoViewImage: false,\r\n      shrinkLogoViewImage: false,\r\n      loginLogoViewImage: false,\r\n      iconIcoViewImage: false,\r\n      coreValidate: {\r\n                          // 表单验证规则\r\n                          platformName: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n                          platformInfo: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n                         // isShowShades: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n                          homeLogo:[{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n                          shrinkLogo: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n                          loginLogo: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n                          iconIco: [{ required: true, message: \"不能为空\", trigger: \"blur\" }]\r\n      },\r\n\r\n      smsValidate: {\r\n        // 表单验证规则\r\n        serviceName: [{ required: true, message: \"请选择\", trigger: \"blur\" }],\r\n        accessKey: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        secretKey: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        signName: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        type: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        templateCode: [{ required: true, message: \"不能为空\", trigger: \"blur\" }]\r\n      },\r\n      emailValidate: {\r\n        // 表单验证规则\r\n        host: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        username: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        password: [{ required: true, message: \"不能为空\", trigger: \"blur\" }]\r\n      },\r\n      vaptchaValidate: {\r\n        // 表单验证规则\r\n        vID: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        secretKey: [{ required: true, message: \"不能为空\", trigger: \"blur\" }]\r\n      },\r\n      otherValidate: {\r\n        // 表单验证规则\r\n        domain: [{ required: true, message: \"不能为空\", trigger: \"blur\" }]\r\n      },\r\n      endpointPH: \"请输入空间访问域名\",\r\n      dictBucketRegions: [\r\n      ],\r\n        dataEdit: \"\", // 编辑数据\r\n        showHTMLModal: false, // 显示html\r\n        full: false, // html全屏开关\r\n        fullscreenModal: false, // 显示全屏预览\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.initOssSet();\r\n      this.initSmsSet();\r\n      this.initEmailSet();\r\n      this.initVaptchaSet();\r\n      this.initOtherSet();\r\n      this.initCoreSet();\r\n      this.getDictBucketRegions();\r\n      this.initEditor();\r\n      this.accessToken = {\r\n        accessToken: this.getStore(\"accessToken\")\r\n      };\r\n    },\r\n\r\n    homeLogoViewPic() {\r\n      this.homeLogoViewImage = true;\r\n    },\r\n    shrinkLogoViewPic() {\r\n      this.shrinkLogoViewImage = true;\r\n    },\r\n    loginLogoViewPic() {\r\n      this.loginLogoViewImage = true;\r\n    },\r\n    iconIcoViewPic() {\r\n      this.iconIcoViewImage = true;\r\n    },\r\n    handleFormatError(file) {\r\n      this.$Notice.warning({\r\n        title: \"不支持的文件格式\",\r\n        desc:\r\n          \"所选文件‘ \" +\r\n          file.name +\r\n          \" ’格式不正确, 请选择 .jpg .jpeg .png .gif格式文件\"\r\n      });\r\n    },\r\n    handleMaxSize(file) {\r\n      this.$Notice.warning({\r\n        title: \"文件大小过大\",\r\n        desc: \"所选文件‘ \" + file.name + \" ’大小过大, 不得超过 5M.\"\r\n      });\r\n    },\r\n    beforeUpload() {\r\n      if (!this.$route.meta.permTypes.includes(\"upload\")) {\r\n        this.$Message.error(\"此处您没有上传权限(为演示功能，该按钮未配置隐藏)\");\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n    homeLogoHandleSuccess(res, file) {//上传成功\r\n      if (res.success === true) {\r\n        file.url = res.result;\r\n        this.core.homeLogo = res.result;\r\n      } else {\r\n        this.$Message.error(res.message);\r\n      }\r\n    },\r\n    shrinkLogoHandleSuccess(res, file) {//上传成功\r\n      if (res.success === true) {\r\n        file.url = res.result;\r\n        this.core.shrinkLogo = res.result;\r\n      } else {\r\n        this.$Message.error(res.message);\r\n      }\r\n    },\r\n    loginLogoHandleSuccess(res, file) {//上传成功\r\n      if (res.success === true) {\r\n        file.url = res.result;\r\n        this.core.loginLogo = res.result;\r\n      } else {\r\n        this.$Message.error(res.message);\r\n      }\r\n    },\r\n    iconIcoHandleSuccess(res, file) {//上传成功\r\n      if (res.success === true) {\r\n        file.url = res.result;\r\n        this.core.iconIco = res.result;\r\n      } else {\r\n        this.$Message.error(res.message);\r\n      }\r\n    },\r\n    handleError(error, file, fileList) {\r\n      this.$Message.error(error.toString());\r\n    },\r\n    initEditor() {\r\n      let that = this;\r\n      editor = new E(this.$refs.editor);\r\n      editor.customConfig.onchange = html => {\r\n        this.core.copyright = xss(html);\r\n      };\r\n      editor.customConfig.uploadImgServer = uploadFile;\r\n      editor.customConfig.uploadImgHeaders = {\r\n        accessToken: that.getStore(\"accessToken\")\r\n      };\r\n      editor.customConfig.uploadFileName = \"file\";\r\n      editor.customConfig.uploadImgHooks = {\r\n        before: function(xhr, editor, files) {},\r\n        success: function(xhr, editor, result) {},\r\n        fail: function(xhr, editor, result) {\r\n          that.$Message.error(\"上传图片失败\");\r\n        },\r\n        error: function(xhr, editor) {\r\n          that.$Message.error(\"上传图片出错\");\r\n        },\r\n        timeout: function(xhr, editor) {\r\n          that.$Message.error(\"上传图片超时\");\r\n        },\r\n        customInsert: function(insertImg, result, editor) {\r\n          if (result.success === true) {\r\n            let url = result.result;\r\n            insertImg(url);\r\n            that.$Message.success(\"上传图片成功\");\r\n          } else {\r\n            that.$Message.error(result.message);\r\n          }\r\n        }\r\n      };\r\n      editor.customConfig.fontNames = [\"微软雅黑\", \"宋体\", \"黑体\", \"Arial\"];\r\n      editor.customConfig.emotions = [\r\n        {\r\n          title: \"新浪\",\r\n          type: \"image\",\r\n          content: sina\r\n        }\r\n      ];\r\n      editor.create();\r\n    },\r\n    editHTML() {\r\n      this.dataEdit = this.core.copyright;\r\n      this.showHTMLModal = true;\r\n    },\r\n    editHTMLOk() {\r\n      editor.txt.html(this.dataEdit);\r\n      this.core.copyright = xss(this.dataEdit);\r\n      this.showHTMLModal = false;\r\n    },\r\n    getDictBucketRegions() {\r\n      getDictDataByType(\"tencent_bucket_region\").then(res => {\r\n        if (res.success) {\r\n          this.dictBucketRegions = res.result;\r\n        }\r\n      });\r\n    },\r\n    initOssSet() {\r\n      this.loading = true;\r\n      checkOssSet().then(res => {\r\n        if (res.success && res.result) {\r\n          let oss = res.result;\r\n          getOssSet(oss).then(res => {\r\n            this.loading = false;\r\n            if (res.result) {\r\n              // 转换null为\"\"\r\n              for (let attr in res.result) {\r\n                if (res.result[attr] === null) {\r\n                  res.result[attr] = \"\";\r\n                }\r\n              }\r\n              this.oss = res.result;\r\n            } else {\r\n              this.changedOssSK = true;\r\n            }\r\n          });\r\n        } else {\r\n          this.loading = false;\r\n          this.changedOssSK = true;\r\n        }\r\n      });\r\n    },\r\n    changeOss(v) {\r\n      if (v == \"ALI_OSS\") {\r\n        this.endpointPH = \"请输入EndPoint(地域节点) 非Bucket域名\";\r\n      } else if (v == \"TENCENT_OSS\") {\r\n        this.endpointPH =\r\n          \"请输入完整请求域名\";\r\n      } else {\r\n        this.endpointPH = \"请输入空间访问域名\";\r\n      }\r\n      getOssSet(v).then(res => {\r\n        if (res.result) {\r\n          // 转换null为\"\"\r\n          for (let attr in res.result) {\r\n            if (res.result[attr] === null) {\r\n              res.result[attr] = \"\";\r\n            }\r\n          }\r\n          this.oss = res.result;\r\n          this.changedOssSK = false;\r\n        } else {\r\n          this.oss = { serviceName: v };\r\n          if (this.oss.serviceName == \"LOCAL_OSS\") {\r\n            this.oss.http = \"http://\";\r\n            this.oss.endpoint = \"127.0.0.1:9999/xboot/file/view\";\r\n          }\r\n          this.changedOssSK = true;\r\n        }\r\n      });\r\n    },\r\n    initSmsSet() {\r\n      this.loading = true;\r\n      getSmsSet(this.sms.serviceName).then(res => {\r\n        this.loading = false;\r\n        if (res.result) {\r\n          // 转换null为\"\"\r\n          for (let attr in res.result) {\r\n            if (res.result[attr] === null) {\r\n              res.result[attr] = \"\";\r\n            }\r\n          }\r\n          this.sms = res.result;\r\n          this.sms.type = \"-1\";\r\n          this.changeSmsType(this.sms.type);\r\n        } else {\r\n          this.changedSmsSK = true;\r\n        }\r\n      });\r\n    },\r\n    changeSmsType(v) {\r\n      getSmsTemplateCode(v).then(res => {\r\n        if (res.success) {\r\n          this.sms.templateCode = res.result;\r\n        }\r\n      });\r\n    },\r\n    initEmailSet() {\r\n      this.loading = true;\r\n      getEmailSet().then(res => {\r\n        this.loading = false;\r\n        if (res.result) {\r\n          // 转换null为\"\"\r\n          for (let attr in res.result) {\r\n            if (res.result[attr] === null) {\r\n              res.result[attr] = \"\";\r\n            }\r\n          }\r\n          this.email = res.result;\r\n        } else {\r\n          this.changedEmailPass = true;\r\n        }\r\n      });\r\n    },\r\n    initVaptchaSet() {\r\n      this.loading = true;\r\n      getVaptchaSet().then(res => {\r\n        this.loading = false;\r\n        if (res.result) {\r\n          // 转换null为\"\"\r\n          for (let attr in res.result) {\r\n            if (res.result[attr] === null) {\r\n              res.result[attr] = \"\";\r\n            }\r\n          }\r\n          this.vaptcha = res.result;\r\n        } else {\r\n          this.changedVaptchaSK = true;\r\n        }\r\n      });\r\n    },\r\n    initOtherSet() {\r\n      this.loading = true;\r\n      getOtherSet().then(res => {\r\n        this.loading = false;\r\n        if (res.result) {\r\n          // 转换null为\"\"\r\n          for (let attr in res.result) {\r\n            if (res.result[attr] === null) {\r\n              res.result[attr] = \"\";\r\n            }\r\n          }\r\n          this.other = res.result;\r\n        }\r\n      });\r\n    },\r\n\r\n    initCoreSet() {\r\n      this.loading = true;\r\n      getCoreSet().then(res => {\r\n\r\n        this.loading = false;\r\n        if (res.result) {\r\n          // 转换null为\"\"\r\n          for (let attr in res.result) {\r\n            if (res.result[attr] === null) {\r\n              res.result[attr] = \"\";\r\n            }\r\n          }\r\n          this.core = res.result;\r\n\r\n          editor.txt.html(this.core.copyright);\r\n        }\r\n      });\r\n    },\r\n    seeSecret(name) {\r\n      if (!name) {\r\n        return;\r\n      }\r\n      seeSecretSet(name).then(res => {\r\n        if (res.success) {\r\n          if (this.tabName == \"oss\") {\r\n            this.oss.secretKey = res.result;\r\n            this.changedOssSK = true;\r\n          } else if (this.tabName == \"sms\") {\r\n            this.sms.secretKey = res.result;\r\n            this.changedSmsSK = true;\r\n          } else if (this.tabName == \"email\") {\r\n            this.email.password = res.result;\r\n            this.changedEmailPass = true;\r\n          } else if (this.tabName == \"vaptcha\") {\r\n            this.vaptcha.secretKey = res.result;\r\n            this.changedVaptchaSK = true;\r\n          }\r\n        }\r\n      });\r\n    },\r\n    saveEditOss() {\r\n      if (this.oss.serviceName == \"LOCAL_OSS\") {\r\n        if (!this.oss.http) {\r\n          this.errorMsg = \"请选择http协议\";\r\n          return;\r\n        } else {\r\n          this.errorMsg = \"\";\r\n        }\r\n        if (!this.oss.endpoint) {\r\n          this.errorMsg = \"请输入文件预览接口\";\r\n          return;\r\n        } else {\r\n          this.errorMsg = \"\";\r\n        }\r\n        if (!this.oss.filePath) {\r\n          this.errorMsg2 = \"请输入存储磁盘路径\";\r\n          return;\r\n        } else {\r\n          this.errorMsg2 = \"\";\r\n        }\r\n        editOssSet(this.oss).then(res => {\r\n          this.saveLoading = false;\r\n          if (res.success) {\r\n            this.$Message.success(\"保存成功\");\r\n          }\r\n        });\r\n      } else {\r\n        this.$refs.ossForm.validate(valid => {\r\n          if (valid) {\r\n            if (!this.oss.http) {\r\n              this.errorMsg = \"请选择http协议\";\r\n              return;\r\n            } else {\r\n              this.errorMsg = \"\";\r\n            }\r\n            this.saveLoading = true;\r\n            this.oss.changed = this.changedOssSK;\r\n            editOssSet(this.oss).then(res => {\r\n              this.saveLoading = false;\r\n              if (res.success) {\r\n                this.$Message.success(\"保存成功\");\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }\r\n    },\r\n    saveEditSms() {\r\n      this.$refs.smsForm.validate(valid => {\r\n        if (valid) {\r\n          this.saveLoading = true;\r\n          this.sms.changed = this.changedSmsSK;\r\n          editSmsSet(this.sms).then(res => {\r\n            this.saveLoading = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"保存成功\");\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    saveEditEmail() {\r\n      this.$refs.emailForm.validate(valid => {\r\n        if (valid) {\r\n          this.saveLoading = true;\r\n          this.email.changed = this.changedEmailPass;\r\n          editEmailSet(this.email).then(res => {\r\n            this.saveLoading = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"保存成功\");\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    saveEditVaptcha() {\r\n      this.$refs.vaptchaForm.validate(valid => {\r\n        if (valid) {\r\n          this.saveLoading = true;\r\n          this.vaptcha.changed = this.changedVaptchaSK;\r\n          editVaptchaSet(this.vaptcha).then(res => {\r\n            this.saveLoading = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"保存成功\");\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    saveEditOther() {\r\n      this.$refs.otherForm.validate(valid => {\r\n        if (valid) {\r\n          this.saveLoading = true;\r\n          editOtherSet(this.other).then(res => {\r\n            this.saveLoading = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"保存成功\");\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    saveEditCore() {\r\n      this.$refs.coreForm.validate(valid => {\r\n        if (valid) {\r\n          this.saveLoading = true;\r\n          editCoreSet(this.core).then(res => {\r\n            this.saveLoading = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"保存成功\");\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  },\r\n  mounted() {\r\n    let name = this.$route.query.name;\r\n    if (name) {\r\n      this.tabName = name;\r\n    }\r\n    this.init();\r\n  }\r\n};\r\n</script>"]}]}